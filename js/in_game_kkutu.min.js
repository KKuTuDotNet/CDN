/**
ⓒ 2017-2019 KKuTuDotNet. All Rights Reserved.
This program is distributed by terms of GNU Affero General Public License.
For more information, please check <https://www.gnu.org/licenses/agpl-3.0.html>.
*/


var MODE,MOREMI_PART,AVAIL_EQUIP,RULE,OPTIONS,ws,rws,$stage,$rec,mobile,BEAT=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],CDN="https://cdn.jsdelivr.net/npm/kkutudotnet@latest",NULL_USER={profile:{title:L.null},data:{score:0}},MAX_LEVEL=720,TICK=30,EXP=[],BAD=new RegExp(["느으*[^가-힣]*금마?","니[^가-힣]*(엄|앰|엠)","(ㅄ|ㅅㅂ|ㅂㅅ)","미친(년|놈)?","(병|븅|빙)[^가-힣]*신","보[^가-힣]*지","(새|섀|쌔|썌)[^가-힣]*(기|끼)","섹[^가-힣]*스","(시|씨|쉬|쒸)이*입?[^가-힣]*(발|빨|벌|뻘|팔|펄)","십[^가-힣]*새","씹","(애|에)[^가-힣]*미","자[^가-힣]*지","존[^가-힣]*나","좆|죶","지랄","창[^가-힣]*(녀|년|놈)","fuck","sex"].join("|"),"g"),ADVBAD=new RegExp(["(시|싀|쉬|슈|씨|쒸|씌|쓔|쑤|시이|싀이|쉬이|씨이|쒸이|씌이|찌이|스|쓰|쯔|스으|쓰으|쯔으|수우|쑤우|십|싑|쉽|슙|씹|쓉|씝|쓥|씁|싶|싚|슆|슾|앂|씦|쓒|씊|쑾|ㅅ|ㅆ|ㅅㅣ|ㅅ이|ㅆ이|c|c이|Ⓒ|Ⓒ이|씨이이|시이이|쓰으으|스으으)[^가-힣]*(바|파|발|팔|빠|빨|불|벌|벨|밸|빠|ㅂ|ㅃ|ㅍ)","(병|뱡|뱅|뱡|빙|븅|븽|뷰웅|비잉|볭|뱽|뼝|뺑|쁑|삥|삉|뺭|뼈엉|쀼웅|ㅂ)[^가-힣]*(신|싄|슨|씬|씐|진|즨|ㅅ|딱|시인|시나)","(새|섀|세|셰|쌔|쎄|썌|쎼)[^가-힣]*(끼|끠|애끼|에끼)","(저새|저색|저섀|저세|저셰|저쌔|저쎄|저썌|저쎼)[^가-힣]*(기|애기|에기)","(개|게|계|걔|깨|께|꼐|꺠)[^가-힣]*(새|세|섀|셰)","(니|닝|느|노|늬|너|쟤|유|걔|ㄴ)[^가-힣]*(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄마|검마|검|금|미|앰|앱|아빠|엄빠|의미|의비|븨|믜)","(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄마|검마|앰|아빠|엄빠)[^가-힣]*(죽|뒤|사|돌|없)","(앰|엠|얨|옘)[^가-힣]*(창|챵|촹|생|섕|셍|솅|쉥)","(세|섹|색|쉑|쇡|세크|새크|셍|셱|섁|세그|세엑|세액)[^가-힣]*(ㅅ|스|슥|슨|슫|슷|승|로스)","(ㅈ|젓|젔|젇|젖|좟|좠|좓|좢)[^가-힣]*(됟|됫|됬|됏|됐|됃|같|갇|까|가|까|카)","(잠|좌|잗|잣|쟈|보|볻|봇|뵤)[^가-힣]*(지|짓|짇|징|즤|즫|즷|즹|빨)","(질|입|안|밖)[^가-힣]*(싸)","(후|훚|훗|훋)[^가-힣]*(장|쟝|좡)","(꼬|보|딸|똘|빡)[^가-힣]*(추)","(미친|잡|쓰레기|거지|그지|똥|ㅣ발)[^가-힣]*(녀석|놈|충|자식|냐|냔|세|네|것)","(버|벅|뻐|뻑|퍽)[^가-힣]*(큐|뀨)","(호)[^가-힣]*(로|모|구)","(스|수|슈|쓰|쑤|쓔|스으|수우|슈우|쓰우|쑤으|쓔으)[^가-힣]*(레|래|럐|례|랙|렉|럑|롁|랚|렊|럒|롂)","(지|즤|디|G|ㅣ|치|찌|지이|즤이|G이)[^가-힣]*(랄|라알)","(딸)[^가-힣]*(딸|치|쳐|쳤|침)","발[^가-힣]*기","풀[^가-힣]*발","딸[^가-힣]*딸","강[^가-힣]*간","자[^가-힣]*위","부[^가-힣]*랄","불[^가-힣]*알","오[^가-힣]*르[^가-힣]*가[^가-힣]*즘","처[^가-힣]*녀[^가-힣]*막","질[^가-힣]*내","질[^가-힣]*외","정[^가-힣]*액","자[^가-힣]*궁","생[^가-힣]*리","월[^가-힣]*경","페[^가-힣]*도","또[^가-힣]*라[^가-힣]*이","장[^가-힣]*애","종[^가-힣]*간","쓰[^가-힣]*레[^가-힣]*기","무[^가-힣]*뇌","학[^가-힣]*식[^가-힣]*충","급[^가-힣]*식[^가-힣]*충","버[^가-힣]*러[^가-힣]*지","찌[^가-힣]*꺼[^가-힣]*기","삐[^가-힣]*꾸","닥[^가-힣]*쳐","꺼[^가-힣]*져","애[^가-힣]*자","찌[^가-힣]*그[^가-힣]*레[^가-힣]*기","대[^가-힣]*가[^가-힣]*리","면[^가-힣]*상","와[^가-힣]*꾸","시[^가-힣]*빠[^가-힣]*빠","파[^가-힣]*오[^가-힣]*후","사[^가-힣]*까[^가-힣]*시","씹[^가-힣]*덕","애[^가-힣]*미","엿[^가-힣]*먹","애[^가-힣]*비","새[^가-힣]*끼","줬[^가-힣]*까","(뒤)[^가-힣]*(져|진|졌|질|짐)","살[^가-힣]*지[^가-힣]*마","자[^가-힣]*살[^가-힣]*(해|하|헤)","(좆|좃|좄|졷|줫|줮|줟|죶|죳|죴|죧)","씹|씹","봊|봊","잦|잦","(섹|섻)","썅|썅","ㅗ|ㅗ","ㅄ|ㅄ","ㄲㅈ|ㄲㅈ","(ㅈ)[^가-힣]*(ㅂㅅ|ㄲ|ㄹ|ㄴ)","(f|F)[^A-Za-z]*(u|U)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(d|D)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(m|M)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(m|M)[^A-Za-z]*(n|N)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(b|B)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(c|C)[^A-Za-z]*(h|H)","(d|D)[^A-Za-z]*(i|I)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*x","(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(c|C)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(t|T)","(p|P)[^A-Za-z]*(u|U)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(y|Y)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(g|G)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(a|A)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(r|R)[^A-Za-z]*(o|O)","(j|J)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(m|M)[^A-Za-z]*(u|U)[^A-Za-z]*(f|F)[^A-Za-z]*(f|F)","(p|P)[^A-Za-z]*(i|I)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)","(r|R)[^A-Za-z]*(e|E)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(s|S)[^A-Za-z]*(l|L)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(t|T)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(s|S)","(t|T)[^A-Za-z]*(r|R)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)","(t|T)[^A-Za-z]*(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)","(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(w|W)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(r|R)[^A-Za-z]*(e|E)","(s|S)[^A-Za-z]*(i|I)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)","(g|G)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(a|A)[^A-Za-z]*(k|K)[^A-Za-z]*(i|I)","(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(l|L)[^A-Za-z]*(e|E)","(t|T)[^A-Za-z]*(l|L)[^A-Za-z]*q[^A-Za-z]*(k|K)[^A-Za-z]*(f|F)","(t|T)[^A-Za-z]*(p|P)[^A-Za-z]*(r|R)[^A-Za-z]*(t|T)[^A-Za-z]*(m|M)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*(e|E)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)","わ[^ぁ-んァ-ン]*る[^ぁ-んァ-ン]*く[^ぁ-んァ-ン]*ち","ぶ[^ぁ-んァ-ン]*べ[^ぁ-んァ-ン]*つ[^ぁ-んァ-ン]*","ゴ[^ぁ-んァ-ン]*ミ","ク[^ぁ-んァ-ン]*ズ","カ[^ぁ-んァ-ン]*ス","外[^ぁ-んァ-ン]*道","ゲ[^ぁ-んァ-ン]*ロ","ダ[^ぁ-んァ-ン]*メ[^ぁ-んァ-ン]*人[^ぁ-んァ-ン]*間","木[^ぁ-んァ-ン]*偶","ろ[^ぁ-んァ-ン]*く[^ぁ-んァ-ン]*で[^ぁ-んァ-ン]*な[^ぁ-んァ-ン]*し","ま[^ぁ-んァ-ン]*ぬ[^ぁ-んァ-ン]*け","ご[^ぁ-んァ-ン]*ろ[^ぁ-んァ-ン]*つ[^ぁ-んァ-ン]*き","バ[^ぁ-んァ-ン]*カ","ブ[^ぁ-んァ-ン]*ス","ビ[^ぁ-んァ-ン]*ッ[^ぁ-んァ-ン]*チ","さ[^ぁ-んァ-ン]*ん[^ぁ-んァ-ン]*し[^ぁ-んァ-ン]*た","死[^ぁ-んァ-ン]*に[^ぁ-んァ-ン]*損[^ぁ-んァ-ン]*な[^ぁ-んァ-ン]*い"].join("|")),$sound={},$_sound={},$data={},$lib={Classic:{},Jaqwi:{},Crossword:{},Typing:{},Hunmin:{},Daneo:{},Sock:{},Drawing:{}},audioContext=!!window.hasOwnProperty("AudioContext")&&new AudioContext,_WebSocket=window.WebSocket,_setInterval=setInterval,_setTimeout=setTimeout,isWelcome=!1;function onSpace(a){32==a.keyCode&&($stage.chatBtn.trigger("click"),a.preventDefault())}function drawList(){var a=$data._list.slice($data.chain),e=$data.room.opts.proverb?1:5,t="",o=a[0].length;o>=20&&(t="18px"),o>=50&&(t="15px"),$stage.game.display.css("font-size",t),a[0]="<label style='color: #FFFF44;'>"+a[0]+"</label>",$stage.game.display.html(a.slice(0,e).join(" ")),$stage.game.chain.show().html($data.chain),$(".jjo-turn-time .graph-bar").width("100%").html(a.slice(e,2*e).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function restGoing(a){$(".jjo-turn-time .graph-bar").html(a+L.afterRun),a>0&&addTimeout(restGoing,1e3,a-1)}function drawSpeed(a){var e;for(e in a)$("#game-user-"+e+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(a[e]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}$(document).ready(function(){var a;for($data.PUBLIC="true"==$("#PUBLIC").html(),$data.URL=$("#URL").html(),$data.version=$("#version").html(),$data.server=location.href.match(/\?.*server=(\d+)/)[1],$data.shop={},$data._okg=0,$data._playTime=0,$data._kd="",$data._timers=[],$data._obtain=[],$data._wblock={},$data._shut={},$data.usersR={},EXP.push(getRequiredScore(1)),a=2;a<MAX_LEVEL;a++)EXP.push(EXP[a-2]+getRequiredScore(a));if(EXP[MAX_LEVEL-1]=1/0,EXP.push(1/0),$stage={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),chatLog:$("#chat-log-board"),talk:$("#Talk"),chatBtn:$("#ChatBtn"),menu:{refresh:$("#RefreshBtn"),help:$("#HelpBtn"),bulletin:$("#BulletinBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),leaderboard:$("#LeaderboardBtn"),user:$("#UserBtn"),userList:$("#UserListBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),community:$("#CommunityDiag"),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileReport:$("#profile-report"),profileCopy:$("#profile-copy"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),report:$("#ReportDialog"),reportOK:$("#report-ok"),newnick:$("#NewNickDialog"),newnickOK:$("#newnick-ok"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag"),bulletin:$("#BulletinDiag"),notice:$("#NoticeDiag"),noticeOK:$("notice-ok"),user:$("#UserDiag"),message:$("#MsgDiag"),ask:$("#AskDiag"),blocked:$("#BlockedDiag"),password:$("#PasswordDiag"),whichhand:$("#WhichHandDiag"),selectItem:$("#SelectItemDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),tools:$(".GameBox .tools"),drawingTitle:$("#drawing-title"),themeisTitle:$("#themeis-title"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},void 0==_WebSocket)return loading(L.websocketUnsupport),void akAlert(L.websocketUnsupport);for(a in $data.opts=$.cookie("kks"),$data.opts?applyOptions(JSON.parse($data.opts),!0):applyOptions([],!0),$data.opts.istheme=void 0===$data.opts.tm||$data.opts.tm,$data.opts.istheme&&$("#Background").attr("src","").addClass("jt-image").css({"background-image":"url(https://cdn.jsdelivr.net/npm/kkutudotnet@latest/img/kkutu/kkutudotnet.png)","background-size":"200px 200px"}),$data.selectedBGM=void 0===$data.opts.sb?"start":$data.opts.sb,$data.selectedLobbyBGM=void 0===$data.opts.so?"start":$data.opts.so,$data.loadedBGM=$data.selectedBGM,$data.loadedLobbyBGM=$data.selectedLobbyBGM,$data._soundList=function(){var e=[{key:"k",value:CDN+"/media/"+$data.selectedBGM+"/k.mp3"},{key:"lobby",value:CDN+"/media/"+$data.selectedLobbyBGM+"/LobbyBGM.mp3"},{key:"jaqwi",value:CDN+"/media/"+$data.selectedBGM+"/JaqwiBGM.mp3"},{key:"jaqwiF",value:CDN+"/media/"+$data.selectedBGM+"/JaqwiFastBGM.mp3"},{key:"game_start",value:CDN+"/media/"+$data.selectedBGM+"/game_start.mp3"},{key:"round_start",value:CDN+"/media/"+$data.selectedBGM+"/round_start.mp3"},{key:"fail",value:CDN+"/media/"+$data.selectedBGM+"/fail.mp3"},{key:"timeout",value:CDN+"/media/"+$data.selectedBGM+"/timeout.mp3"},{key:"lvup",value:CDN+"/media/"+$data.selectedBGM+"/lvup.mp3"},{key:"Al",value:CDN+"/media/"+$data.selectedBGM+"/Al.mp3"},{key:"success",value:CDN+"/media/"+$data.selectedBGM+"/success.mp3"},{key:"missing",value:CDN+"/media/"+$data.selectedBGM+"/missing.mp3"},{key:"mission",value:CDN+"/media/"+$data.selectedBGM+"/mission.mp3"},{key:"kung",value:CDN+"/media/"+$data.selectedBGM+"/kung.mp3"},{key:"horr",value:CDN+"/media/"+$data.selectedBGM+"/horr.mp3"}];for(a=0;a<=10;a++)e.push({key:"T"+a,value:CDN+"/media/"+$data.selectedBGM+"/T"+a+".mp3"},{key:"K"+a,value:CDN+"/media/"+$data.selectedBGM+"/K"+a+".mp3"},{key:"As"+a,value:CDN+"/media/"+$data.selectedBGM+"/As"+a+".mp3"});return e},loadSounds($data._soundList(),function(){processShop(d)}),akAlert=function(a,e,t){var o=$stage.dialog.message,r=$("#msg-overlay");o.data("callback")&&(o.data("callback")(!1),o.data({})),o.find("#msg-ok").off("click").click(function(a){o.hide(),r.hide()}),o.find("#msg-no").off("click").click(function(a){o.hide(),r.hide()}),e&&r.show(),o.find("#msg-no").hide(),o.find("#msg-content").html(a),showDialog(o,!0),t&&setTimeout(function(){o.hide(),r.hide()},t)},akConfirm=function(a,e,t){var o=$stage.dialog.message,r=$("#msg-overlay");o.data("callback")&&(o.data("callback")(!1),o.data({})),o.data({callback:e}),o.find("#msg-ok").off("click").click(function(a){o.hide(),r.hide(),o.data("callback")&&(o.data("callback")(!0),o.data({}))}),o.find("#msg-no").off("click").click(function(a){o.hide(),r.hide(),o.data("callback")&&(o.data("callback")(!1),o.data({}))}),t&&r.show(),o.find("#msg-no").show(),o.find("#msg-content").html(a),showDialog(o,!0)},akPrompt=function(a,e){var t=$stage.dialog.ask;t.data("callback")&&(t.data("callback")(!1),t.data({})),t.data({callback:e}),t.find("#ask-ok").off("click").click(function(a){t.hide();var e=$("#ask-input").val();$("#ask-input").val(""),e=void 0!==e?e.trim():"",t.data("callback")&&(t.data("callback")(e),t.data({}))}),t.find("#ask-no").off("click").click(function(a){t.hide(),$("#ask-input").val(""),t.data("callback")&&(t.data("callback")(!1),t.data({}))}),t.find("#ask-no").show(),t.find("#ask-content").html(a),showDialog(t,!0)},akPrompt.whichHand=function(a,e){var t=$stage.dialog.whichhand;t.data("callback")&&(t.data("callback")(!1),t.data({})),t.data({callback:e}),t.find("#hand-left").off("click").click(function(a){t.hide(),t.data("callback")&&(t.data("callback")("left"),t.data({}))}),t.find("#hand-right").off("click").click(function(a){t.hide(),t.data("callback")&&(t.data("callback")("right"),t.data({}))}),t.find("#hand-no").off("click").click(function(a){t.hide(),t.data("callback")&&(t.data("callback")(!1),t.data({}))}),t.find("#hand-no").show(),t.find("#hand-content").html(a),showDialog(t)},akPrompt.password=function(a,e){var t=$stage.dialog.password;t.data("callback")&&(t.data("callback")(!1),t.data({})),t.data({callback:e}),t.find("#password-ok").off("click").click(function(a){t.hide();var e=$("#password-input").val();$("#password-input").val(""),e=void 0!==e?e.trim():"",t.data("callback")&&(t.data("callback")(e),t.data({}))}),t.find("#password-no").off("click").click(function(a){t.hide(),$("#password-input").val(""),t.data("callback")&&(t.data("callback")(!1),t.data({}))}),t.find("#password-no").show(),t.find("#password-content").html(a),showDialog(t,!0)},akPrompt.item=function(a){var e=$stage.dialog.selectItem,t=$("#msg-overlay");e.find("#item-skip").off("click").click(function(){e.hide(),t.hide(),send(a,{item:"skip"})}),e.find("#item-reverse").off("click").click(function(){e.hide(),t.hide(),send(a,{item:"reverse"})}),e.find("#item-random").off("click").click(function(){e.hide(),t.hide(),send(a,{item:"random"})}),t.show(),showDialog(e,!0)},$(window).bind("beforeunload",function(a){return"정말로 게임을 중단하고 나가시겠습니까?"}),MOREMI_PART=$("#MOREMI_PART").html().split(","),AVAIL_EQUIP=$("#AVAIL_EQUIP").html().split(","),RULE=JSON.parse($("#RULE").html()),OPTIONS=JSON.parse($("#OPTIONS").html()),MODE=Object.keys(RULE),(mobile="true"==$("#mobile").html())&&(TICK=200),$data._timePercent=function(){return 100-($data._turnSound.audio?$data._turnSound.audio.currentTime:audioContext.currentTime-$data._turnSound.startedAt)/$data.turnTime*1e5+"%"},$data.setRoom=function(a,e){var t="for-lobby"==getOnly();null==e?(delete $data.rooms[a],t&&$("#room-"+a).remove()):(t&&!$data.rooms[a]&&$stage.lobby.roomList.append($("<div>").attr("id","room-"+a)),$data.rooms[a]=e,t&&$("#room-"+a).replaceWith(roomListBar(e)))},$data.setUser=function(a,e){var t,o=getOnly(),r="for-lobby"==o||"for-master"==o;$data._replay?$rec.users[a]=e:null==e?(delete $data.users[a],r&&$("#users-item-"+a+",#invite-item-"+a).remove()):(r&&!$data.users[a]&&(t=userListBar(e,"for-master"==o),"for-master"==o?$stage.dialog.inviteList.append(t):$stage.lobby.userList.append(t)),$data.users[a]=e,r&&(t?$("#"+t.attr("id")).replaceWith(t):$("#"+("for-lobby"==o?"users-item-":"invite-item")+a).replaceWith(userListBar(e,"for-master"==o))))},$("#Talk").emojionePicker({pickerTop:12,pickerRight:-21,type:"unicode"}),$(document).on("paste",function(a){if($data.room&&$data.room.gaming)return a.preventDefault(),!1}),$stage.talk.on("drop",function(a){if($data.room&&$data.room.gaming)return a.preventDefault(),!1}),$(".dialog-head .dialog-title").on("mousedown",function(a){var e,t,o,r,d=$(a.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),d.addClass("dialog-front"),e=d,t=a.pageX,o=a.pageY,r=e.position(),$(window).on("mousemove",function(a){var d=a.pageX-t,i=a.pageY-o;e.css("left",r.left+d),e.css("top",r.top+i)})}).on("mouseup",function(a){$(window).off("mousemove")}),$stage.chatBtn.on("click",function(a){checkInput();var e=mobile&&$stage.game.here.is(":visible")?$stage.game.hereText.val():$stage.talk.val(),t={value:e};e&&("/"==t.value[0]?(t.cmd=t.value.split(" "),runCommand(t.cmd)):(($stage.game.here.is(":visible")||$data._relay)&&(t.relay=!0),send("talk",t)),$data._whisper?($stage.talk.val("/e "+$data._whisper+" "),delete $data._whisper):$stage.talk.val(""),$stage.game.hereText.val(""))}).hotkey($stage.talk,13).hotkey($stage.game.hereText,13),$("#cw-q-input").on("keydown",function(a){if(13==a.keyCode){var e=$(a.currentTarget),t=e.val(),o={relay:!0,data:$data._sel,value:t};if(!t)return;send("talk",o),e.val("")}}).on("focusout",function(a){$(".cw-q-body").empty(),$stage.game.cwcmd.css("opacity",0)}),$("#room-limit").on("change",function(a){var e=$(a.currentTarget),t=e.val();t<2||t>8?e.css("color","#FF4444"):e.css("color","")}),$("#room-time").on("change",function(a){var e=$(a.currentTarget),t=e.val();t<1||t>300?e.css("color","#FF4444"):e.css("color","")}),$("#room-round").on("change",function(a){var e=$(a.currentTarget),t=e.val();t<1||t>10?e.css("color","#FF4444"):e.css("color","")}),$stage.game.here.on("click",function(a){mobile||$stage.talk.focus()}),$stage.talk.on("keyup",function(a){$stage.game.hereText.val($stage.talk.val())}),$(window).on("beforeunload",function(a){if($data.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),$stage.dialog)$stage.dialog[a].children(".dialog-head").hasClass("no-close")||$stage.dialog[a].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(a){$(a.currentTarget).parent().parent().hide(),$("#msg-overlay").hide()}).hotkey(!1,27));function e(a,e){var t,o;for(t in OPTIONS)o=OPTIONS[t].name.toLowerCase(),-1==a.indexOf(t)?$("#"+e+"-"+o+"-panel").hide():$("#"+e+"-"+o+"-panel").show()}function t(a){var e,t,o={};for(e in OPTIONS)t=OPTIONS[e].name.toLowerCase(),$("#"+a+"-"+t).is(":checked")&&(o[t]=!0);return o}function o(a,e,t,o){var r;if(!o){if(a.gaming)return!1;if(a.password)return!1;if(a.players.length>=a.limit)return!1}if(a.mode!=e)return!1;for(r in t)if(!a.opts[r])return!1;return!0}for($stage.menu.refresh.on("click",function(a){$stage.menu.refresh.addClass("toggled"),send("refresh"),updateUI(void 0,!0),$stage.menu.refresh.removeClass("toggled")}),$stage.menu.help.on("click",function(a){$("#help-board").attr("src","/help"),showDialog($stage.dialog.help)}),$stage.menu.user.on("click",function(a){$("#user-board").attr("src","/user"),showDialog($stage.dialog.user)}),$stage.menu.bulletin.on("click",function(a){$("#bulletin-board").attr("src","/bulletin"),showDialog($stage.dialog.bulletin)}),$stage.menu.setting.on("click",function(a){showDialog($stage.dialog.setting)}),$stage.menu.community.on("click",function(a){if($data.guest)return fail(451);showDialog($stage.dialog.community)}),$stage.dialog.commFriendAdd.on("click",function(a){akPrompt(L.friendAddNotice,function(a){if(a)return $data.users[a]?void send("friendAdd",{target:a},!0):fail(450)})}),$stage.menu.newRoom.on("click",function(a){var e;$stage.dialog.quick.hide(),$data.typeRoom="enter",showDialog(e=$stage.dialog.room),e.find(".dialog-title").html(L.newRoom)}),$stage.menu.setRoom.on("click",function(a){var e,t,o,r=RULE[MODE[$data.room.mode]];for(t in $data.typeRoom="setRoom",$("#room-title").val($data.room.title),$("#room-limit").val($data.room.limit),$("#room-mode").val($data.room.mode).trigger("change"),$("#room-round").val($data.room.round),$("#room-time").val($data.room.time/r.time),OPTIONS)o=OPTIONS[t].name.toLowerCase(),$("#room-"+o).attr("checked",$data.room.opts[o]);$data._injpick=$data.room.opts.injpick,showDialog(e=$stage.dialog.room),e.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(a){var r,d,i=$("#quick-mode").val(),s=0;for(r in"quick-mode"==a.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),d=t("quick"),e(RULE[MODE[i]].opts,"quick"),$data.rooms)o($data.rooms[r],i,d,!0)&&s++;$("#quick-status").html(L.quickStatus+" "+s)}),$stage.menu.quickRoom.on("click",function(a){$stage.dialog.room.hide(),showDialog($stage.dialog.quick),$stage.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-queue").html(""),$stage.dialog.quickOK.removeClass("searching").html(L.OK))}),$stage.dialog.quickOK.on("click",function(a){var e=$("#quick-mode").val(),r=t("quick");if("for-lobby"==getOnly()){if($stage.dialog.quickOK.hasClass("searching"))return $stage.dialog.quick.hide(),d(),void $stage.menu.quickRoom.trigger("click");$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),$stage.dialog.quickOK.addClass("searching").html("<i class='kd kd-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),$data._quickn=0,$data._quickT=addInterval(d,1e3)}function d(){var a,t=[];if($stage.dialog.quick.is(":visible")){for(a in $("#quick-queue").html(L.quickQueue+" "+prettyTime(1e3*$data._quickn++)),$data.rooms)o($data.rooms[a],e,r)&&t.push(a);t.length&&(a=t[Math.floor(Math.random()*t.length)],$data._preQuick=!0,$("#room-"+a).trigger("click"))}else clearTimeout($data._quickT)}}),$("#room-mode").on("change",function(a){var t=$("#room-mode").val(),o=RULE[MODE[t]];$("#game-mode-expl").html(L["modex"+t]),e(o.opts,"room"),$data._injpick=[],-1!=o.opts.indexOf("ijp")?$("#room-injpick-panel").show():$("#room-injpick-panel").hide(),"Typing"==o.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(a,e){$(e).html(Number($(e).val())*o.time+L.SECOND)})}).trigger("change"),$stage.menu.spectate.on("click",function(a){$stage.menu.spectate.hasClass("toggled")?(send("form",{mode:"J"}),$stage.menu.spectate.removeClass("toggled")):(send("form",{mode:"S"}),$stage.menu.spectate.addClass("toggled"))}),$stage.menu.shop.on("click",function(a){($data._shop=!$data._shop)?(loadShop(),$stage.menu.shop.addClass("toggled")):$stage.menu.shop.removeClass("toggled"),updateUI()}),$(".shop-type").on("click",function(a){var e=$(a.currentTarget),t=e.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),e.addClass("selected"),filterShop("all"==t||e.attr("value"))}),$stage.menu.dict.on("click",function(a){showDialog($stage.dialog.dict)}),$stage.menu.wordPlus.on("click",function(a){showDialog($stage.dialog.wordPlus)}),$stage.menu.invite.on("click",function(a){showDialog($stage.dialog.invite),updateUserList(!0)}),$stage.menu.practice.on("click",function(a){RULE[MODE[$data.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),$data.room.opts.item?akConfirm("아이템전 특수 규칙이 활성화되어 사기 끄투 봇으로만 연습이 가능합니다. 계속 진행하시겠습니까?",function(a){a&&send("practice",{level:4})},!0):showDialog($stage.dialog.practice)):send("practice",{level:-1})}),$stage.menu.ready.on("click",function(a){$data.room.opts.item&&!$stage.menu.ready.hasClass("toggled")?akPrompt.item("ready"):send("ready")}),$stage.menu.start.on("click",function(a){!$data._spectate&&$data.room.opts.item?akPrompt.item("start"):send("start")}),$stage.menu.exit.on("click",function(a){$data.room.gaming?$data._spectate||$data.practicing||!$data.room.opts.noleave?akConfirm(L.sureExit,function(a){a&&(clearGame(),send("leave"))},!0):$data.pexit?($data.pexit=!1,$("#ExitBtn").removeClass("toggled")):(akAlert("중도 퇴장이 불가능한 방입니다. 게임이 끝나면 자동으로 나가지도록 예약되었습니다.",!0),$("#ExitBtn").addClass("toggled"),$data.pexit=!0):send("leave")}),$stage.menu.replay.on("click",function(a){$data._replay&&replayStop(),showDialog($stage.dialog.replay),$stage.dialog.replayView.attr("disabled",!0),$stage.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),$stage.menu.leaderboard.on("click",function(a){$data._lbpage=0,$stage.dialog.leaderboard.is(":visible")?$stage.dialog.leaderboard.hide():$.get("/ranking",function(a){drawLeaderboard(a),showDialog($stage.dialog.leaderboard)})}),$stage.menu.userList.on("click",function(a){$stage.box.userList.is(":visible")?($stage.menu.userList.removeClass("toggled"),$stage.box.userList.hide()):($stage.menu.userList.addClass("toggled"),$stage.box.userList.show())}),$stage.dialog.selectItem.on("click",function(a){}),$stage.dialog.lbPrev.on("click",function(a){$(a.currentTarget).attr("disabled",!0),$.get("/ranking?p="+($data._lbpage-1),function(a){drawLeaderboard(a)})}),$stage.dialog.lbMe.on("click",function(a){$(a.currentTarget).attr("disabled",!0),$.get("/ranking?id="+$data.id,function(a){drawLeaderboard(a)})}),$stage.dialog.lbNext.on("click",function(a){$(a.currentTarget).attr("disabled",!0),$.get("/ranking?p="+($data._lbpage+1),function(a){drawLeaderboard(a)})}),$stage.dialog.settingServer.on("click",function(a){location.href="/"}),$stage.dialog.settingOK.on("click",function(a){applyOptions({vb:$("#volume-bgm").val(),ve:$("#volume-effect").val(),bd:$("#badwords").is(":checked"),ba:$("#strict-badwords").is(":checked"),tm:$("#kkutudotnet-theme").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),sb:$("#select-bgm").val(),so:$("#select-lobby-bgm").val(),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),$.cookie("kks",JSON.stringify($data.opts)),send("refresh"),updateUI(void 0,!0),$stage.dialog.setting.hide()}),$stage.dialog.profileLevel.on("click",function(a){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),showDialog($stage.dialog.practice)}),$stage.dialog.practiceOK.on("click",function(a){var e=$("#practice-level").val(),t=$("#ai-team").val();$stage.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?send("setAI",{target:$data._profiled,level:e,team:t}):send("practice",{level:e})}),$stage.dialog.roomOK.on("click",function(a){var e,t,o={injpick:$data._injpick};for(e in OPTIONS)o[t=OPTIONS[e].name.toLowerCase()]=$("#room-"+t).is(":checked");send($data.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),time:$("#room-time").val(),opts:o}),$stage.dialog.room.hide()}),$stage.dialog.resultOK.on("click",function(a){1==$data._resultPage&&$data._resultRank?drawRanking($data._resultRank[$data.id]):($data.practicing&&($data.room.gaming=!0,send("leave")),$data.pexit&&(clearGame(),$data.pexit=!1,send("leave")),$data.resulting=!1,$stage.dialog.result.hide(),delete $data._replay,delete $data._resultRank,$stage.box.room.height(360),playBGM("lobby"),forkChat(),updateUI())}),$stage.dialog.resultSave.on("click",function(a){var e=new Date($rec.time),t=new Blob([JSON.stringify($rec)],{type:"text/plain"}),o=URL.createObjectURL(t),r="KKuTuDotNet-"+e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds()+".net",d=$("<a>").attr({download:r,href:o}).on("click",function(a){d.remove()});$("#Jungle").append(d),d[0].click()}),$stage.dialog.dictInjeong.on("click",function(a){var e=$(a.currentTarget);e.is(":disabled")||$("#dict-theme").val()&&(e.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(a){if(addTimeout(function(){e.prop("disabled",!1)},2e3),a.error)return $("#dict-output").html(a.error+": "+L["wpFail_"+a.error]);$("#dict-output").html(L.wpSuccess+"("+a.message+")")}))}),$stage.dialog.dictSearch.on("click",function(a){var e=$(a.currentTarget);e.is(":disabled")||(e.prop("disabled",!0),$("#dict-output").html(L.searching),tryDict($("#dict-input").val(),function(a){if(addTimeout(function(){e.prop("disabled",!1)},500),a.error)return $("#dict-output").html(a.error+": "+L["wpFail_"+a.error]);$("#dict-output").html(processWord(a.word,a.mean,a.theme,a.type.split(",")))}))}).hotkey($("#dict-input"),13),$stage.dialog.wordPlusOK.on("click",function(a){var e;$stage.dialog.wordPlusOK.hasClass("searching")||(e=$("#wp-input").val())&&((e=e.replace(/[^a-z가-힣]/g,"")).length<2||($("#wp-input").val(""),$(a.currentTarget).addClass("searching").html("<i class='kd kd-spin fa-spinner'></i>"),send("wp",{value:e})))}).hotkey($("#wp-input"),13),$stage.dialog.inviteRobot.on("click",function(a){requestInvite("AI")}),$stage.box.me.on("click",function(a){requestProfile($data.id)}),$stage.dialog.roomInfoJoin.on("click",function(a){$stage.dialog.roomInfo.hide(),tryJoin($data._roominfo)}),$stage.dialog.profileHandover.on("click",function(a){akConfirm(L.sureHandover,function(a){a&&send("handover",{target:$data._profiled})},!0)}),$stage.dialog.profileKick.on("click",function(a){send("kick",{robot:$data.robots.hasOwnProperty($data._profiled),target:$data._profiled})}),$stage.dialog.profileReport.on("click",function(a){if($data.guest)akAlert("손님 계정은 인 게임 신고 기능을 이용하실 수 없습니다. 우측 상단 로그인 버튼을 클릭하여 로그인해 주세요.",!0);else{var e={id:$data.users[$data._profiled].id,reason:""};showDialog($stage.dialog.report)&&($data._report=e)}}),$stage.dialog.profileCopy.on("click",function(a){$("#ask-input").val($data.users[$data._profiled].id),$("#ask-input").select(),document.execCommand("copy"),akPrompt("해당 플레이어의 식별 번호가 클립보드에 복사되었습니다.<br>복사된 식별 번호는 다음과 같습니다.",void 0)}),$stage.dialog.reportOK.on("click",function(a){var e=[$("#rsl option:selected").text()];e.push($("#rst").val()),e.length>0&&(send("report",{id:$data._report.id,reason:e.join()}),akAlert("신고가 접수되었습니다. 신고해 주셔서 감사합니다.",!0)),delete $data._report,$stage.dialog.report.hide()}),$stage.dialog.profileShut.on("click",function(a){var e=$data.users[$data._profiled];e&&toggleShutBlock(e.nick)}),$stage.dialog.profileWhisper.on("click",function(a){var e=$data.users[$data._profiled];$stage.talk.val("/e "+e.nick.replace(/\s/g,"")+" ").focus()}),$stage.dialog.profileDress.on("click",function(a){return $data.guest?fail(421):$data._gaming?fail(438):void(showDialog($stage.dialog.dress)&&$.get("/box",function(a){if(a.error)return fail(a.error);$data.box=a,drawMyDress()}))}),$stage.dialog.dressOK.on("click",function(a){$(a.currentTarget).attr("disabled",!0);var e=$data.users[$data.id].nick,t=$("#dress-nick").val();if((t=void 0!==t?t.trim():"").length<2)return akAlert("닉네임은 두 글자 이상으로 해 주세요!"),void $(a.currentTarget).attr("disabled",!1);if(t.length>15)return akAlert("닉네임은 15 글자 이하로 해 주세요!"),void $(a.currentTarget).attr("disabled",!1);if(t.length>0&&!/^[가-힣a-zA-Z0-9][가-힣a-zA-Z0-9 ]*[가-힣a-zA-Z0-9]$/.exec(t))return akAlert("닉네임에는 한글/영문/숫자 및 공백만 사용 가능합니다!"),void $(a.currentTarget).attr("disabled",!1);var o={data:$("#dress-exordial").val(),nick:t};if(o.nick&&0!=o.nick.length||delete o.nick,e!=t)akConfirm("닉네임이 변경되었습니다. 정말로 바꾸시겠습니까?",function(a){$stage.dialog.dressOK.attr("disabled",!1),a&&(t.match(ADVBAD)?akAlert("닉네임에 사용 불가능한 문자가 포함되어 있습니다.",!0):$.post("/dressnick",o,function(a){if(a.error)return fail(a.error);var e=$data.users[$data.id];e.nick=t,e.exordial=badWords($("#dress-exordial").val()||""),updateMe(),requestProfile($data.id),$("#account-info").text(t),$("#users-item-"+$data.id+" .users-name").text(t),send("nickChange",{id:$data.id,nick:t},!0),akAlert("변경이 완료되었습니다.",!0),$stage.dialog.dress.hide(),$stage.box.me.hide(),updateUserList(!0),$stage.box.me.show()}))},!0);else{if($(a.currentTarget).attr("disabled",!0),o.data.match(ADVBAD))return akAlert("소개 한마디에 사용 불가능한 문자가 포함되어 있습니다.",!0),void $(a.currentTarget).attr("disabled",!1);$.post("/exordial",o,function(a){if($stage.dialog.dressOK.attr("disabled",!1),a.error)return fail(a.error);updateMe(),$stage.dialog.dress.hide()})}}),$("#DressDiag .dress-type").on("click",function(a){var e=$(a.currentTarget),t=e.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),e.addClass("selected"),drawMyGoods("all"==t||e.attr("value"))}),$("#dress-cf").on("click",function(a){if($data._gaming)return fail(438);showDialog($stage.dialog.charFactory)&&drawCharFactory()}),$stage.dialog.cfCompose.on("click",function(a){if(!$stage.dialog.cfCompose.hasClass("cf-composable"))return fail(436);akConfirm(L.cfSureCompose,function(a){a&&$.post("/cf",{tray:$data._tray.join("|")},function(a){var e;if(a.error)return fail(a.error);for(e in send("refresh"),$data.users[$data.id].money=a.money,$data.box=a.box,a.gain)queueObtain(a.gain[e]);drawMyDress($data._avGroup),updateMe(),drawCharFactory()})},!0)}),$("#room-injeong-pick").on("click",function(a){var e,t=RULE[MODE[$("#room-mode").val()]];for(e in $("#injpick-list>div").hide(),"ko"==t.lang?($data._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==t.lang&&($data._ijkey="#en-pick-",$("#en-pick-list").show()),$stage.dialog.injPickNo.trigger("click"),$data._injpick)$($data._ijkey+$data._injpick[e]).prop("checked",!0);showDialog($stage.dialog.injPick)}),$stage.dialog.injPickAll.on("click",function(a){$("#injpick-list input").prop("checked",!0)}),$stage.dialog.injPickNo.on("click",function(a){$("#injpick-list input").prop("checked",!1)}),$stage.dialog.injPickOK.on("click",function(a){var e=$($data._ijkey+"list"),t=[];$data._injpick=e.find("input").each(function(a,e){var o=$(e),r=o.attr("id").slice(8);o.is(":checked")&&t.push(r)}),$data._injpick=t,$stage.dialog.injPick.hide()}),$stage.dialog.kickVoteY.on("click",function(a){send("kickVote",{agree:!0}),clearTimeout($data._kickTimer),$stage.dialog.kickVote.hide()}),$stage.dialog.kickVoteN.on("click",function(a){send("kickVote",{agree:!1}),clearTimeout($data._kickTimer),$stage.dialog.kickVote.hide()}),$stage.dialog.purchaseOK.on("click",function(a){$.post("/buy/"+$data._sgood,function(a){var e=$data.users[$data.id];if(a.error)return fail(a.error);akAlert(L.purchased),e.money=a.money,e.box=a.box,updateMe()}),$stage.dialog.purchase.hide()}),$stage.dialog.purchaseNO.on("click",function(a){$stage.dialog.purchase.hide()}),$stage.dialog.obtainOK.on("click",function(a){var e=$data._obtain.shift();e?drawObtain(e):$stage.dialog.obtain.hide()}),a=0;a<5;a++)$("#team-"+a).on("click",r);function r(a){$(".team-selector").hasClass("team-unable")||send("team",{value:$(a.currentTarget).attr("id").slice(5)})}function d(){(ws=new _WebSocket($data.URL)).onopen=function(a){loading(),$data.PUBLIC&&mobile&&$("#ad").append($("<ins>").addClass("kakao_ad_area").css({display:"none",width:"100%"}).attr({"data-ad-unit":"DAN-qy4y6lsg0jzm","data-ad-width":"320","data-ad-height":"100"})).append($("<script>").attr({type:"text/javascript",src:"https://t1.daumcdn.net/adfit/static/ad.min.js"}))},ws.onmessage=_onMessage=function(a){onMessage(JSON.parse(a.data))},ws.onclose=function(a){var e="[#"+a.code+"] "+L.closed;rws&&rws.close(),stopAllSounds(),loading(e),isWelcome=!1},ws.onerror=function(a){console.warn(L.error,a)}}$("#replay-file").on("change",function(a){var e=a.target.files[0],t=new FileReader,o=$("#replay-date").html("-"),r=$("#replay-version").html("-"),d=$("#replay-players").html("-");$rec=!1,$stage.dialog.replayView.attr("disabled",!0),e&&(t.readAsText(e),t.onload=function(a){var e,t;try{for(e in t=JSON.parse(a.target.result),o.html(new Date(t.time).toLocaleString()),r.html(t.version),d.empty(),t.players){var i,s=t.players[e];d.append(i=$("<div>").addClass("replay-player-bar ellipse").html(s.title).prepend(getLevelImage(s.data.score).addClass("users-level"))),s.id==t.me&&i.css("font-weight","bold")}$rec=t,$stage.dialog.replayView.attr("disabled",!1)}catch(a){return console.warn(a),akAlert(L.replayError,!0)}})}),$stage.dialog.replayView.on("click",function(a){replayReady()}),addInterval(function(){spamCount>0?spamCount=0:spamWarning>0&&(spamWarning-=.03)},1e3),_setInterval(function(){isWelcome&&(send("refresh"),$data.room&&send("refresh",void 0,!0))},18e3)}),$lib.Classic.roundReady=function(a){$data.room.game.title.length;clearBoard(),$data._roundTime=1e3*$data.room.time,$stage.game.display.html(getCharText(a.char,a.subChar)),$stage.game.chain.show().html($data.chain=0),$data.room.opts.mission&&$stage.game.items.show().css("opacity",1).html($data.mission=a.mission),"KAP"==MODE[$data.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),drawRound(a.round),playSound("round_start"),recordEvent("roundReady",{data:a})},$lib.Classic.turnStart=function(a){$data.room.game.turn=a.turn,a.seq&&($data.room.game.seq=a.seq),($data._tid=$data.room.game.seq[a.turn])&&($data._tid.robot&&($data._tid=$data._tid.id),a.id=$data._tid,$stage.game.display.html($data._char=getCharText(a.char,a.subChar,a.wordLength)),$("#game-user-"+a.id).addClass("game-user-current"),$data._replay||($stage.game.here.css("display",a.id==$data.id?"block":"none"),a.id==$data.id&&(mobile?$stage.game.hereText.val("").focus():$stage.talk.focus())),$stage.game.items.html($data.mission=a.mission),ws.onmessage=_onMessage,clearInterval($data._tTime),clearTrespasses(),$data._chars=[a.char,a.subChar],$data._speed=a.speed,$data._tTime=addInterval(turnGoing,TICK),$data.turnTime=a.turnTime,$data._turnTime=a.turnTime,$data._roundTime=a.roundTime,$data._turnSound=playSound("T"+a.speed),recordEvent("turnStart",{data:a}))},$lib.Classic.turnGoing=function(){$data.room||clearInterval($data._tTime),$data._turnTime-=TICK,$data._roundTime-=TICK,$stage.game.turnBar.width($data._timePercent()).html((.001*$data._turnTime).toFixed(1)+L.SECOND),$stage.game.roundBar.width($data._roundTime/$data.room.time*.1+"%").html((.001*$data._roundTime).toFixed(1)+L.SECOND),$stage.game.roundBar.hasClass("round-extreme")||$data._roundTime<=5e3&&$stage.game.roundBar.addClass("round-extreme")},$lib.Classic.turnEnd=function(a,e){var t,o=$("<div>").addClass("deltaScore").html(e.score>0?"+"+(e.score-e.bonus):e.score),r=$(".game-user-current");$data._turnSound&&$data._turnSound.stop(),addScore(a,e.score),clearInterval($data._tTime),e.ok?(checkFailCombo(),clearTimeout($data._fail),$stage.game.here.hide(),$stage.game.chain.html(++$data.chain),pushDisplay(e.value,e.mean,e.theme,e.wc)):(checkFailCombo(a),o.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),$stage.game.here.hide(),playSound("timeout")),e.hint&&(e.hint=e.hint._id,-1==(t=e.hint.indexOf($data._chars[0]))&&(t=e.hint.indexOf($data._chars[1])),"KAP"==MODE[$data.room.mode]?$stage.game.display.empty().append($("<label>").css("color","#AAAAAA").html(e.hint.slice(0,t))).append($("<label>").html(e.hint.slice(t))):$stage.game.display.empty().append($("<label>").html(e.hint.slice(0,t+1))).append($("<label>").css("color","#AAAAAA").html(e.hint.slice(t+1)))),e.bonus&&(mobile?o.html("+"+(b.score-b.bonus)+"+"+b.bonus):addTimeout(function(){var a=$("<div>").addClass("deltaScore bonus").html("+"+e.bonus);drawObtainedScore(r,a)},500)),drawObtainedScore(r,o).removeClass("game-user-current"),updateScore(a,getScore(a))},$lib.Jaqwi.roundReady=function(a){var e=L.jqTheme+": "+L["theme_"+a.theme];clearBoard(),$data._roundTime=1e3*$data.room.time,$data._fastTime=1e4,$stage.game.display.html(e),$stage.game.items.hide(),$stage.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(e).css("text-align","center"),drawRound(a.round),playSound("round_start"),clearInterval($data._tTime)},$lib.Jaqwi.turnStart=function(a){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),$data.room.game.seq.indexOf($data.id)>=0&&$stage.game.here.show(),$stage.game.display.html($data._char=a.char),clearInterval($data._tTime),$data._tTime=addInterval(turnGoing,TICK),playBGM("jaqwi")},$lib.Jaqwi.turnGoing=function(){var a,e,t=$stage.game.roundBar;$data.room||clearInterval($data._tTime),$data._roundTime-=TICK,e=$data._spectate?L.stat_spectate:(.001*$data._roundTime).toFixed(1)+L.SECOND,t.width($data._roundTime/$data.room.time*.1+"%").html(e),t.hasClass("round-extreme")||$data._roundTime<=$data._fastTime&&(a=$data.bgm.currentTime/$data.bgm.duration,$data.bgm.paused?stopBGM():playBGM("jaqwiF"),$data.bgm.currentTime=$data.bgm.duration*a,t.addClass("round-extreme"))},$lib.Jaqwi.turnHint=function(a){playSound("mission"),pushHint(a.hint)},$lib.Jaqwi.turnEnd=function(a,e){var t=$("<div>").addClass("deltaScore").html("+"+e.score),o=$("#game-user-"+a);e.giveup?o.addClass("game-user-bomb"):e.answer?($stage.game.here.hide(),$stage.game.display.html($("<label>").css("color","#FFFF44").html(e.answer)),stopBGM(),playSound("horr")):(a==$data.id&&$stage.game.here.hide(),addScore(a,e.score),$data._roundTime>1e4&&($data._roundTime=1e4),drawObtainedScore(o,t),updateScore(a,getScore(a)).addClass("game-user-current"),playSound("success"))},$lib.Crossword.roundReady=function(a,e){var t=a.seq?a.seq.indexOf($data.id):-1;clearBoard(),$(".jjoriping,.rounds,.game-body").addClass("cw"),$data._roundTime=1e3*$data.room.time,$data._fastTime=3e4,$data.selectedRound=-1==t?1:t%$data.room.round+1,$stage.game.items.hide(),$stage.game.cwcmd.show().css("opacity",0),drawRound($data.selectedRound),e||playSound("round_start"),clearInterval($data._tTime)},$lib.Crossword.turnEnd=function(a,e){var t,o,r=$("<div>").addClass("deltaScore").html("+"+e.score),d=$("#game-user-"+a);e.score?(o=e.pos.join(","),a==$data.id?($stage.game.cwcmd.css("opacity",0),playSound("success")):($data._sel&&e.pos.join(",")==$data._sel.join(",")&&$stage.game.cwcmd.css("opacity",0),playSound("mission")),$data._bdb[o][4]=e.value,$data._bdb[o][5]=a,e.pos[0]==$data.selectedRound-1?$lib.Crossword.drawDisplay():(t=$($stage.game.round.children("label").get(e.pos[0])).addClass("round-effect"),addTimeout(function(){t.removeClass("round-effect")},800)),addScore(a,e.score),updateScore(a,getScore(a)),drawObtainedScore(d,r)):(stopBGM(),$stage.game.round.empty(),playSound("horr"))},$lib.Crossword.drawDisplay=function(){var a,e,t,o,r,d,i,s,n,l=$data._boards[$data.selectedRound-1],c=$stage.game.display.empty(),m={};for(e in l)for(o=Number(l[e][0]),r=Number(l[e][1]),d="1"==l[e][2],i=Number(l[e][3]),s=l[e][4],c.append(a=$("<div>").addClass("cw-bar").attr("id","cw-"+o+"-"+r+"-"+l[e][2]).css({top:12.5*r+"%",left:12.5*o+"%",width:12.5*(d?1:i)+"%",height:12.5*(d?i:1)+"%"})),s&&a.addClass("cw-open"),l[e][5]==$data.id?a.addClass("cw-my-open"):a.on("click",$lib.Crossword.onBar).on("mouseleave",$lib.Crossword.onSwap),t=0;t<i;t++)n=o+"-"+r,s&&(m[n]=s.charAt(t)),a.append($("<div>").addClass("cw-cell").attr("id","cwc-"+n).html(m[n]||"")),d?r++:o++},$lib.Crossword.onSwap=function(a){$stage.game.display.prepend($(a.currentTarget))},$lib.Crossword.onRound=function(a){var e=$(a.currentTarget).html().charCodeAt(0)-9311;drawRound($data.selectedRound=e),$(".rounds label").on("click",$lib.Crossword.onRound),$lib.Crossword.drawDisplay()},$lib.Crossword.onBar=function(a){var e=$(a.currentTarget).attr("id").slice(3).split("-"),t=$data._means[$data.selectedRound-1][e.join(",")],o="1"==t.dir;$stage.game.cwcmd.css("opacity",1),$data._sel=[$data.selectedRound-1,e[0],e[1],e[2]],$(".cw-q-head").html(L[o?"cwVert":"cwHorz"]+t.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(processWord("★",t.mean,t.theme,t.type.split(",")))},$lib.Crossword.turnStart=function(a,e){var t,o;for(t in $data._bdb={},$data._boards=a.boards,$data._means=a.means,a.boards)for(o in a.boards[t])$data._bdb[[t,a.boards[t][o][0],a.boards[t][o][1],a.boards[t][o][2]].join(",")]=a.boards[t][o];$(".rounds label").on("click",$lib.Crossword.onRound),$lib.Crossword.drawDisplay(),clearInterval($data._tTime),$data._tTime=addInterval(turnGoing,TICK),playBGM("jaqwi")},$lib.Crossword.turnGoing=$lib.Jaqwi.turnGoing,$lib.Crossword.turnHint=function(a){playSound("fail")},$lib.Typing.roundReady=function(a){$data.room.game.title.length;$data._chatter=mobile?$stage.game.hereText:$stage.talk,clearBoard(),$data._round=a.round,$data._roundTime=1e3*$data.room.time,$data._fastTime=1e4,$data._list=a.list.concat(a.list),$data.chain=0,drawList(),drawRound(a.round),playSound("round_start"),recordEvent("roundReady",{data:a})},$lib.Typing.spaceOn=function(){$data.room.opts.proverb||($data._spaced=!0,$("body").on("keydown","#"+$data._chatter.attr("id"),onSpace))},$lib.Typing.spaceOff=function(){delete $data._spaced,$("body").off("keydown","#"+$data._chatter.attr("id"),onSpace)},$lib.Typing.turnStart=function(a){$data._spectate||($stage.game.here.show(),mobile?$stage.game.hereText.val("").focus():$stage.talk.val("").focus(),$lib.Typing.spaceOn()),ws.onmessage=_onMessage,clearInterval($data._tTime),clearTrespasses(),$data._tTime=addInterval(turnGoing,TICK),$data._roundTime=a.roundTime,playBGM("jaqwi"),recordEvent("turnStart",{data:a})},$lib.Typing.turnGoing=$lib.Jaqwi.turnGoing,$lib.Typing.turnEnd=function(a,e){var t=$("<div>").addClass("deltaScore").html("+"+e.score),o=$("#game-user-"+a);e.error?($data.chain++,drawList(),playSound("fail")):e.ok?($data.id==a?($data.chain++,drawList(),playSound("mission"),pushHistory(e.value,"")):$data._spectate&&playSound("mission"),addScore(a,e.score),drawObtainedScore(o,t),updateScore(a,getScore(a))):(clearInterval($data._tTime),$lib.Typing.spaceOff(),$stage.game.here.hide(),stopBGM(),playSound("horr"),addTimeout(drawSpeed,1e3,e.speed),$data._round<$data.room.round&&restGoing(10))},$lib.Hunmin.roundReady=function(a){$data.room.game.title.length;clearBoard(),$data._roundTime=1e3*$data.room.time,$stage.game.display.html($data._char="&lt;"+a.theme+"&gt;"),$stage.game.chain.show().html($data.chain=0),$data.room.opts.mission&&$stage.game.items.show().css("opacity",1).html($data.mission=a.mission),drawRound(a.round),playSound("round_start"),recordEvent("roundReady",{data:a})},$lib.Hunmin.turnStart=function(a){$data.room.game.turn=a.turn,a.seq&&($data.room.game.seq=a.seq),$data._tid=$data.room.game.seq[a.turn],$data._tid.robot&&($data._tid=$data._tid.id),a.id=$data._tid,$stage.game.display.html($data._char),$("#game-user-"+a.id).addClass("game-user-current"),$data._replay||($stage.game.here.css("display",a.id==$data.id?"block":"none"),a.id==$data.id&&(mobile?$stage.game.hereText.val("").focus():$stage.talk.focus())),$stage.game.items.html($data.mission=a.mission),ws.onmessage=_onMessage,clearInterval($data._tTime),clearTrespasses(),$data._chars=[a.char,a.subChar],$data._speed=a.speed,$data._tTime=addInterval(turnGoing,TICK),$data.turnTime=a.turnTime,$data._turnTime=a.turnTime,$data._roundTime=a.roundTime,$data._turnSound=playSound("T"+a.speed),recordEvent("turnStart",{data:a})},$lib.Hunmin.turnGoing=$lib.Classic.turnGoing,$lib.Hunmin.turnEnd=function(a,e){var t,o=$("<div>").addClass("deltaScore").html(e.score>0?"+"+(e.score-e.bonus):e.score),r=$(".game-user-current");$data._turnSound.stop(),addScore(a,e.score),clearInterval($data._tTime),e.ok?(clearTimeout($data._fail),$stage.game.here.hide(),$stage.game.chain.html(++$data.chain),pushDisplay(e.value,e.mean,e.theme,e.wc)):(o.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),$stage.game.here.hide(),playSound("timeout")),e.hint&&(e.hint=e.hint._id,-1==(t=e.hint.indexOf($data._chars[0]))&&(t=e.hint.indexOf($data._chars[1])),$stage.game.display.empty().append($("<label>").html(e.hint.slice(0,t+1))).append($("<label>").css("color","#AAAAAA").html(e.hint.slice(t+1)))),e.bonus&&(mobile?o.html("+"+(b.score-b.bonus)+"+"+b.bonus):addTimeout(function(){var a=$("<div>").addClass("deltaScore bonus").html("+"+e.bonus);drawObtainedScore(r,a)},500)),drawObtainedScore(r,o).removeClass("game-user-current"),updateScore(a,getScore(a))},$lib.Daneo.roundReady=function(a){$data.room.game.title.length;clearBoard(),$data._roundTime=1e3*$data.room.time,$stage.game.display.html($data._char="&lt;"+L["theme_"+a.theme]+"&gt;"),$stage.game.chain.show().html($data.chain=0),$data.room.opts.mission&&$stage.game.items.show().css("opacity",1).html($data.mission=a.mission),drawRound(a.round),playSound("round_start"),recordEvent("roundReady",{data:a})},$lib.Daneo.turnStart=function(a){$data.room.game.turn=a.turn,a.seq&&($data.room.game.seq=a.seq),$data._tid=$data.room.game.seq[a.turn],$data._tid.robot&&($data._tid=$data._tid.id),a.id=$data._tid,$stage.game.display.html($data._char),$("#game-user-"+a.id).addClass("game-user-current"),$data._replay||($stage.game.here.css("display",a.id==$data.id?"block":"none"),a.id==$data.id&&(mobile?$stage.game.hereText.val("").focus():$stage.talk.focus())),$stage.game.items.html($data.mission=a.mission),ws.onmessage=_onMessage,clearInterval($data._tTime),clearTrespasses(),$data._chars=[a.char,a.subChar],$data._speed=a.speed,$data._tTime=addInterval(turnGoing,TICK),$data.turnTime=a.turnTime,$data._turnTime=a.turnTime,$data._roundTime=a.roundTime,$data._turnSound=playSound("T"+a.speed),recordEvent("turnStart",{data:a})},$lib.Daneo.turnGoing=$lib.Classic.turnGoing,$lib.Daneo.turnEnd=function(a,e){var t,o=$("<div>").addClass("deltaScore").html(e.score>0?"+"+(e.score-e.bonus):e.score),r=$(".game-user-current");$data._turnSound.stop(),addScore(a,e.score),clearInterval($data._tTime),e.ok?(clearTimeout($data._fail),$stage.game.here.hide(),$stage.game.chain.html(++$data.chain),pushDisplay(e.value,e.mean,e.theme,e.wc)):(o.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),$stage.game.here.hide(),playSound("timeout")),e.hint&&(e.hint=e.hint._id,-1==(t=e.hint.indexOf($data._chars[0]))&&(t=e.hint.indexOf($data._chars[1])),$stage.game.display.empty().append($("<label>").html(e.hint.slice(0,t+1))).append($("<label>").css("color","#AAAAAA").html(e.hint.slice(t+1)))),e.bonus&&(mobile?o.html("+"+(b.score-b.bonus)+"+"+b.bonus):addTimeout(function(){var a=$("<div>").addClass("deltaScore bonus").html("+"+e.bonus);drawObtainedScore(r,a)},500)),drawObtainedScore(r,o).removeClass("game-user-current"),updateScore(a,getScore(a))},$lib.Drawing.roundReady=function(a,e){L.jqTheme,L["theme_"+a.theme];clearBoard(),$(".jjoriping,.rounds,.game-body").addClass("cw"),$(".jjoriping,.rounds").addClass("dg"),$(".game-user-drawing").removeClass("game-user-drawing"),$stage.game.tools.hide(),$data._relay=!1,$data._roundTime=1e3*$data.room.time,$data._fastTime=1e4,$stage.game.items.hide(),$stage.game.hints.show(),$stage.game.cwcmd.show().css("opacity",0),$data.id===a.painter?(console.log("i'm painter!"),$data._isPainter=!0):$data._isPainter=!1,$("#game-user-"+a.painter).addClass("game-user-drawing"),drawRound(a.round),playSound("round_start"),clearInterval($data._tTime)},$lib.Drawing.turnStart=function(a,e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),$data.room.game.seq.indexOf($data.id)>=0&&($data._isPainter?($("#drawing-line-width").change(function(){console.log(this.value),$stage.game.canvas.freeDrawingBrush.width=this.value,send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$("#drawing-color").change(function(){console.log(this.value),$stage.game.canvas.freeDrawingBrush.color=this.value,send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$("#drawing-clear").click(function(){console.log("clear"),$stage.game.canvas.clear(),send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-red").click(function(){console.log("change red"),$stage.game.canvas.freeDrawingBrush.color="#FF0000",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-orange").click(function(){console.log("change orange"),$stage.game.canvas.freeDrawingBrush.color="#FFA500",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-yellow").click(function(){console.log("change yellow"),$stage.game.canvas.freeDrawingBrush.color="#FFFF00",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-green").click(function(){console.log("change green"),$stage.game.canvas.freeDrawingBrush.color="#008000",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-blue").click(function(){console.log("change blue"),$stage.game.canvas.freeDrawingBrush.color="#0000FF",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-indigo").click(function(){console.log("change indigo"),$stage.game.canvas.freeDrawingBrush.color="#4B0082",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-violet").click(function(){console.log("change red"),$stage.game.canvas.freeDrawingBrush.color="#9400D3",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-black").click(function(){console.log("change black"),$stage.game.canvas.freeDrawingBrush.color="#000000",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$(".button-color#color-white").click(function(){console.log("change white"),$stage.game.canvas.freeDrawingBrush.color="#FFFFFF",send("drawingCanvas",{data:JSON.stringify($stage.game.canvas)},!1)}),$stage.game.drawingTitle.text(a.word),$stage.game.themeisTitle.text(L["theme_"+a.theme]),$stage.game.hints.hide(),$stage.game.tools.show(),$(".rounds").removeClass("dg"),$(".rounds").addClass("painter")):($stage.game.hints.show(),$stage.game.tools.hide(),$data._relay=!0)),$lib.Drawing.drawDisplay(),clearInterval($data._tTime),$data._tTime=addInterval(turnGoing,TICK),playBGM("jaqwi")},$lib.Drawing.turnHint=function(a){var e;e=Array.isArray(a.hint)?L["theme_"+a.hint[0]]:a.hint,playSound("mission"),pushHint(e)},$lib.Drawing.turnEnd=function(a,e){var t=$("<div>").addClass("deltaScore").html("+"+e.score),o=$("#game-user-"+a);e.giveup?(o.addClass("game-user-bomb"),$data._relay=!1):e.answer?($stage.game.here.hide(),$stage.game.display.html($("<label>").css("color","#FFFF44").html(e.answer)),stopBGM(),playSound("horr"),$data._relay=!1):(a==$data.id&&$stage.game.here.hide(),addScore(a,e.score),$data._roundTime>1e4&&($data._roundTime=1e4),drawObtainedScore(o,t),updateScore(a,getScore(a)).addClass("game-user-current"),playSound("success"))},$lib.Drawing.drawDisplay=function(){$stage.game.display.empty().append($("<canvas>").attr("id","canvas").css({width:"300",height:"300",left:0,top:0}).addClass("canvas"));var a=window._canvas=new fabric.Canvas("canvas");a.backgroundColor="#ffffff",a.isDrawingMode=$data._isPainter,a.setHeight(300),a.setWidth(300),a.selection=!1,$("#drawing-line-width").val(20),$("#drawing-color").val("#000000"),$data._isPainter&&a.on("mouse:up",function(e){send("drawingCanvas",{data:JSON.stringify(a)},!1)}),a.renderAll(),$stage.game.canvas=a},$lib.Drawing.turnGoing=function(){var a,e,t=$stage.game.roundBar;$data.room||clearInterval($data._tTime),$data._roundTime-=TICK,e=$data._spectate?L.stat_spectate:(.001*$data._roundTime).toFixed(1)+L.SECOND,t.width($data._roundTime/$data.room.time*.1+"%").html(e),t.hasClass("round-extreme")||$data._roundTime<=$data._fastTime&&(a=$data.bgm.currentTime/$data.bgm.duration,$data.bgm.paused?stopBGM():playBGM("jaqwiF"),$data.bgm.currentTime=$data.bgm.duration*a,t.addClass("round-extreme"))},$lib.Drawing.drawCanvas=function(a){$data._isPainter||($stage.game.canvas.clear(),$stage.game.canvas.loadFromJSON(a.data,$stage.game.canvas.renderAll.bind($stage.game.canvas)))},$lib.Sock.roundReady=function(a,e){a.seq&&a.seq.indexOf($data.id);clearBoard(),$data._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),$data._va=[],$data._lang=RULE[MODE[$data.room.mode]].lang,$data._board=a.board,$data._maps=[],$data._roundTime=1e3*$data.room.time,$data._fastTime=1e4,$stage.game.items.hide(),$stage.game.bb.show(),$lib.Sock.drawDisplay(),drawRound(a.round),e||playSound("round_start"),clearInterval($data._tTime)},$lib.Sock.turnEnd=function(a,e){var t,o,r,d=$("<div>").addClass("deltaScore").html("+"+e.score),i=$("#game-user-"+a);if(e.score){for(r=(t=e.value).length,$data._maps.push(t),o=0;o<r;o++)$data._board=$data._board.replace(t.charAt(o),"　");a==$data.id?playSound("success"):playSound("mission"),$lib.Sock.drawDisplay(),addScore(a,e.score),updateScore(a,getScore(a)),drawObtainedScore(i,d)}else stopBGM(),$data._relay=!1,playSound("horr")},$lib.Sock.drawMaps=function(){$stage.game.bb.empty(),$data._maps.sort(function(a,e){return e.length-a.length}).forEach(function(a){$stage.game.bb.append(function(a){var e,t=$("<div>").addClass("bb-word"),o=a.length;for(e=0;e<o;e++)t.append($("<div>").addClass("bb-char").html(a.charAt(e)));return t}(a))})},$lib.Sock.drawDisplay=function(){var a,e=$("<div>").css("height","100%"),t=$data._board.split(""),o="ko"==$data._lang?"12.5%":"10%";t.forEach(function(t,r){e.append(a=$("<div>").addClass("sock-char sock-"+t).css({width:o,height:o}).html(t)),$data._va[r]&&$data._va[r]!=t&&a.html($data._va[r]).addClass("sock-picked").animate({opacity:0},500)}),$data._va=t,$stage.game.display.empty().append(e),$lib.Sock.drawMaps()},$lib.Sock.turnStart=function(a,e){clearInterval($data._tTime),$data._tTime=addInterval(turnGoing,TICK),playBGM("jaqwi")},$lib.Sock.turnGoing=$lib.Jaqwi.turnGoing,$lib.Sock.turnHint=function(a){playSound("fail")};var spamWarning=0,spamCount=0;function zeroPadding(a,e){var t=a.toString();return"000000000000000".slice(0,Math.max(0,e-t.length))+t}function send(a,e,t){var o,r={type:a},d=t?ws:rws||ws;for(o in e)r[o]=e[o];if("test"!=a&&spamCount++>10){if(++spamWarning>=3)return d.close();spamCount=5}d.send(JSON.stringify(r))}function loading(a){a?$("#Intro").is(":visible")?($stage.loading.hide(),$("#intro-text").html(a)):$stage.loading.show().html(a):$stage.loading.hide()}function showDialog(a,e){var t=[$(window).width(),$(window).height()];return!e&&a.is(":visible")?(a.hide(),!1):($(".dialog-front").removeClass("dialog-front"),a.show().addClass("dialog-front").css({left:.5*(t[0]-a.width()),top:.5*(t[1]-a.height())}),!0)}function applyOptions(a,e){$data.opts=a,$data.opts.isbad=void 0===$data.opts.bd||$data.opts.bd,$data.opts.isadvbad=void 0!==$data.opts.ba&&$data.opts.ba,$data.opts.istheme=void 0===$data.opts.tm||$data.opts.tm,$data.selectedBGM=void 0===$data.opts.sb?"start":$data.opts.sb,$data.selectedLobbyBGM=void 0===$data.opts.so?"start":$data.opts.so,$data.muteBGM=0==$data.opts.vb,$data.muteEff=0==$data.opts.ve,$("#volume-bgm").val($data.opts.vb),$("#volume-effect").val($data.opts.ve),$("#badwords").attr("checked",$data.opts.isbad),$("#strict-badwords").attr("checked",$data.opts.isadvbad),$("#kkutudotnet-theme").attr("checked",$data.opts.istheme),$("#deny-invite").attr("checked",$data.opts.di),$("#deny-whisper").attr("checked",$data.opts.dw),$("#deny-friend").attr("checked",$data.opts.df),$("#auto-ready").attr("checked",$data.opts.ar),$("#sort-user").attr("checked",$data.opts.su),$("#only-waiting").attr("checked",$data.opts.ow),$("#only-unlock").attr("checked",$data.opts.ou),$("#select-bgm").val($data.selectedBGM),$("#select-lobby-bgm").val($data.selectedLobbyBGM),$data.bgm&&(e||$data.loadedBGM==$data.selectedBGM&&$data.loadedLobbyBGM==$data.selectedLobbyBGM?$data.muteBGM?$data.bgm.stop():$data.bgm=playBGM($data.bgm.key,!0):(loadSounds($data._soundList(),!1,!0),akAlert("배경 음악이 변경되었습니다. 배경 음악/효과음 음량을 조절하시거나 게임을 시작하시면 바로 적용됩니다.",!0),$data.loadedBGM=$data.selectedBGM,$data.loadedLobbyBGM=$data.selectedLobbyBGM))}function checkInput(){}function addInterval(a,e,t,o,r,d,i){var s=_setInterval(a,e,t,o,r,d,i);return $data._timers.push(s),s}function addTimeout(a,e,t,o,r,d,i){var s=_setTimeout(a,e,t,o,r,d,i);return $data._timers.push(s),s}function clearTrespasses(){return}function route(a,e,t,o,r,d){if($data.room){var i=RULE[MODE[$data.room.mode]];if(!i)return null;$lib[i.rule][a].call(this,e,t,o,r,d)}}function connectToRoom(a,e){$data.URLL=$data.URL;var t=$data.URL.replace(/\/g([0-9]{4})\//,function(e,t){return"/g"+(Number(t)+410+Number(a)-1)+"/"})+"&"+a+"&"+e;rws||(rws=new _WebSocket(t),loading(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){loading(),rws&&rws.close()}),rws.onopen=function(t){console.log("room-conn",a,e)},rws.onmessage=_onMessage,rws.onclose=function(t){console.log("room-disc",a,e),rws=void 0},rws.onerror=function(a){console.warn(L.error,a)})}function checkAge(){if(!confirm(L.checkAgeAsk))return send("caj",{answer:"no"},!0);for(;;){for(var a=[],e=1;e<=3;){var t=prompt(L["checkAgeInput"+e]);if(t&&!isNaN(t=Number(t)))1==e&&(t<1e3||t>2999)?akAlert(t+"\n"+L.checkAgeNo):2==e&&(t<1||t>12)?akAlert(t+"\n"+L.checkAgeNo):3==e&&(t<1||t>31)?akAlert(t+"\n"+L.checkAgeNo):a[e++-1]=t;else if(--e<1)break}if(4==e){if(confirm(L.checkAgeSure+"\n"+a[0]+L.YEAR+" "+a[1]+L.MONTH+" "+a[2]+L.DATE))return send("caj",{answer:"yes",input:[a[1],a[2],a[0]]},!0)}else if(confirm(L.checkAgeCancel))return send("caj",{answer:"no"},!0)}}function onMessage(a){var e,o;switch(a.type){case"recaptcha":var r=$("#intro-text");r.empty(),r.html("게스트는 캡챠 인증이 필요합니다.<br/>로그인을 하시면 캡챠 인증을 건너뛰실 수 있습니다.<br/><br/>"),r.append($('<div class="g-recaptcha" id="recaptcha" style="display: table; margin: 0 auto;"></div>')),grecaptcha.render("recaptcha",{sitekey:a.siteKey,callback:function(a){ws.send(JSON.stringify({type:"recaptcha",token:a}))}});break;case"welcome":if($data.id=a.id,$data.nick=a.nick,$data.guest=a.guest,$data.admin=a.admin,$data.users=a.users,$data.robots={},$data.rooms=a.rooms,$data.place=0,$data.friends=a.friends,$data._friends={},$data._playTime=a.playTime,$data._okg=a.okg,$data._gaming=!1,$data.box=a.box,a.test&&akAlert(L.welcomeTestServer,!0),location.hash[1]&&tryJoin(location.hash.slice(1)),updateUI(void 0,!0),welcome(),a.caj&&checkAge(),updateCommunity(),"nonick"==$data.nick)(s=$stage.dialog.newnick).parent().append(ov=$("<div />",{id:"newnick-overlay",style:"position:absolute;top:0;left:0;width:100%;height:100%;opacity:0.8;background:black;"})),s.find("#newnick-ok").off("click").click(function(a){var e=$("#newnick-input").val();if((e=void 0!==e?e.trim():"").length<2)return akAlert("닉네임은 두글자 이상으로 해주세요!",!0),void $(a.currentTarget).attr("disabled",!1);if(e.length>15)return akAlert("닉네임은 15글자 이하로 해주세요!",!0),void $(a.currentTarget).attr("disabled",!1);if(e.length>0&&!/^[가-힣a-zA-Z0-9][가-힣a-zA-Z0-9 ]*[가-힣a-zA-Z0-9]$/.exec(e))return akAlert("닉네임에는 한글/영문/숫자 및 공백만 사용 가능합니다!",!0),void $(a.currentTarget).attr("disabled",!1);if(e.match(ADVBAD))akAlert("닉네임에 사용 불가능한 문자가 포함되어 있습니다.",!0);else{var t={nick:e};t.nick&&0!=t.nick.length||delete t.nick,$.post("/newnick",t,function(a){if(a.error)return fail(a.error);$data.nick=e,$("#account-info").text(e),$("#users-item-"+$data.id+" .users-name").text(e),send("newNick",{id:$data.id,nick:e},!0),send("refresh"),akAlert("닉네임 설정이 완료되었습니다! 궁금하신 점이 있으시다면 좌측 상단 물음표 아이콘을 클릭하여 도움말을 열어보세요.",!0),updateUserList(!0),requestProfile($data.id),s.hide(),ov.hide()})}}),showDialog($stage.dialog.newnick,!1),ov.show();var d=new Date;if(a.guest)akAlert("환영합니다. 현재 손님 계정 접속 상태입니다. 우측 상단 로그인 단추 클릭 후 네이버, 구글 등의 계정으로 로그인 시 더욱 즐거운 플레이가 가능합니다.",!0);else if(!$.cookie("isChecked")||$.cookie("isChecked")!=d.getDate()){var i=$stage.dialog.notice;$("#notice-board").attr("src","/kkutu/announcement"),i.find("#notice-ok").off("click").click(function(a){$.cookie("isChecked",d.getDate()),i.hide()}),i.show()}break;case"conn":$data.setUser(a.user.id,a.user),updateUserList();break;case"disconn":$data.setUser(a.id,null),updateUserList();break;case"connRoom":$data._preQuick&&(playSound("success"),$stage.dialog.quick.hide(),delete $data._preQuick),$stage.dialog.quick.hide(),$data.setUser(a.user.id,a.user),(o=$data.usersR[a.user.id]=a.user).id==$data.id?loading():notice((o.profile.title||o.profile.name)+L.hasJoined),updateUserList();break;case"disconnRoom":(o=$data.usersR[a.id])&&(delete $data.usersR[a.id],notice((o.profile.title||o.profile.name)+L.hasLeft),updateUserList());break;case"yell":yell(a.value),notice(a.value,L.yell);break;case"dying":yell(L.dying),notice(L.dying,L.yell);break;case"tail":notice(a.a+"|"+a.rid+"@"+a.id+": "+(a.msg instanceof String?a.msg:JSON.stringify(a.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"tail");break;case"chat":a.notice?notice(L["error_"+a.code]):chat(a.profile||{title:L.robot},a.value,a.whisper,a.timestamp);break;case"drawCanvas":$stage.game.canvas&&drawCanvas(a);break;case"roomStuck":rws.close();break;case"preRoom":connectToRoom(a.channel,a.id);break;case"room":processRoom(a),checkRoom(a.modify&&a.myRoom),updateUI(a.myRoom),a.modify&&$data.room&&a.myRoom&&($data._rTitle!=$data.room.title&&animModified(".room-head-title"),$data._rMode!=getOptions($data.room.mode,$data.room.opts,!0)&&animModified(".room-head-mode"),$data._rLimit!=$data.room.limit&&animModified(".room-head-limit"),$data._rRound!=$data.room.round&&animModified(".room-head-round"),$data._rTime!=$data.room.time&&animModified(".room-head-time"));break;case"user":$data.setUser(a.id,a),$data.room&&updateUI($data.room.id==a.place);break;case"friends":for(e in $data._friends={},a.list)a.list[e].forEach(function(a){$data._friends[a]={server:e}});updateCommunity();break;case"friend":$data._friends[a.id]={server:"on"==a.stat&&a.s},$data._friends[a.id]&&$data.friends[a.id]&&notice(("on"==a.stat?"&lt;<b>"+L["server_"+$data._friends[a.id].server]+"</b>&gt; ":"")+L.friend+" "+$data.friends[a.id]+L["fstat_"+a.stat]),updateCommunity();break;case"friendAdd":o=$data.users[a.from].profile,e=(o.title||o.name)+"(#"+a.from.substr(0,5)+")",$data.opts.df?send("friendAddRes",{from:a.from,res:!1},!0):akConfirm(e+L.attemptFriendAdd,function(e){send("friendAddRes",{from:a.from,res:e},!0)});break;case"friendAddRes":o=$data.users[a.target].profile,notice((e=(o.title||o.name)+"(#"+a.target.substr(0,5)+")")+L["friendAddRes_"+(a.res?"ok":"no")]),a.res&&($data.friends[a.target]=o.title||o.name,$data._friends[a.target]={server:$data.server},updateCommunity());break;case"friendEdit":$data.friends=a.friends,updateCommunity();break;case"nickChange":$data.setUser(a.id,a),$data.nick=a.nick,updateUserList();break;case"starting":loading(L.gameLoading);break;case"roundReady":route("roundReady",a);break;case"turnStart":route("turnStart",a);break;case"turnError":turnError(a.code,a.value);break;case"turnHint":route("turnHint",a);break;case"turnEnd":a.score=Number(a.score),a.bonus=Number(a.bonus),$data.room&&($data._tid=a.target||$data.room.game.seq[$data.room.game.turn],$data._tid&&($data._tid.robot&&($data._tid=$data._tid.id),turnEnd($data._tid,a)),a.baby&&playSound("success"));break;case"roundEnd":for(e in a.users)$data.setUser(e,a.users[e]);$data._resultRank=a.ranks,roundEnd(a.result,a.data);break;case"kickVote":$data._kickTarget=$data.users[a.target],$data.id!=a.target&&$data.id!=$data.room.master&&kickVoting(a.target),notice(($data._kickTarget.profile.title||$data._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":notice(getKickText($data._kickTarget.profile,a));break;case"invited":$data.opts.di?send("inviteRes",{from:a.from,res:!1}):akConfirm(a.from+L.invited,function(e){send("inviteRes",{from:a.from,res:e})});case"inviteNo":notice(((o=$data.users[a.target]).profile.title||o.profile.name)+L.inviteDenied);break;case"okg":$data._playTime>a.time?notice(L.okgExpired):$data._okg!=a.count&&notice(L.okgNotice+" ("+L.okgCurrent+a.count+")"),$data._playTime=a.time,$data._okg=a.count;break;case"obtain":queueObtain(a);break;case"expired":for(e in a.list)notice(iName(a.list[e])+L.hasExpired);break;case"blocked":notice(L.blocked);break;case"notice":notice(a.value,L.yell);break;case"alert":akAlert(a.value,a.overlay);break;case"test":($data._test=!$data._test)?($data._testt=addInterval(function(){$stage.talk.val()!=$data._ttv&&(send("test",{ev:"c",v:$stage.talk.val()},!0),$data._ttv=$stage.talk.val())},100),document.onkeydown=function(a){send("test",{ev:"d",c:a.keyCode},!0)},document.onkeyup=function(a){send("test",{ev:"u",c:a.keyCode},!0)}):(clearInterval($data._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":switch(e=a.message||"",a.code){case 403:case 2010:loading(),akAlert("[#"+a.code+"] "+L["error_"+a.code]+e,!0);break;case 406:$stage.dialog.quick.is(":visible")&&($data._preQuick=!1),loading(),akAlert("[#"+a.code+"] "+L["error_"+a.code]+e,!0);break;case 416:akConfirm(L["error_"+a.code],function(e){e&&(stopBGM(),$data._spectate=!0,$data._gaming=!0,send("enter",{id:a.target,password:$data._pw,spectate:!0},!0))});break;case 413:$stage.dialog.room.hide(),$stage.menu.setRoom.trigger("click"),akAlert("[#"+a.code+"] "+L["error_"+a.code]+e,!0);break;case 429:playBGM("lobby"),akAlert("[#"+a.code+"] "+L["error_"+a.code]+e,!0);break;case 430:if($data.setRoom(a.message,null),$stage.dialog.quick.is(":visible")){$data._preQuick=!1;break}case 431:case 432:case 433:$stage.dialog.room.show(),akAlert("[#"+a.code+"] "+L["error_"+a.code]+e,!0);break;case 444:e=a.message,t=a.time;var s,n=new Date(parseInt(t));if(loading(),$(".kkutu-menu button").hide(),$stage.box.me.show(),$stage.box.chat.show().width(790).height(190),$stage.chat.height(120),$stage.box.userList.show(),$stage.box.roomList.show(),$(".kkutu-menu .for-lobby").show(),welcome(),(s=$stage.dialog.blocked).parent().append(ov=$("<div />",{id:"block-overlay",style:"position:absolute;top:0;left:0;width:100%;height:100%;opacity:0.8;background:black;"})),isNaN(n))s.find("#blocked-content").html("<h3><b>운영정책 위반으로 서비스 이용이 정지되었습니다.</b></h3><br><b>차단 사유:</b> "+e+"<br><b>차단 기간:</b> 영구 차단"),showDialog($stage.dialog.blocked,!1);else{var l={year:n.getFullYear(),month:n.getMonth()+1,date:n.getDate(),hour:n.getHours(),minute:n.getMinutes()};s.find("#blocked-content").html("<h3><b>운영정책 위반으로 서비스 이용이 정지되었습니다.</b></h3><br><b>차단 사유:</b> "+e+"<br><b>차단 기간:</b> "+l.year+"년 "+l.month+"월 "+l.date+"일 "+l.hour+"시 "+l.minute+"분 까지"),showDialog($stage.dialog.blocked,!1)}break;case 416:case 434:case 435:case 436:case 438:akAlert("[#"+a.code+"] "+L["error_"+a.code]+e);break;default:akAlert("[#"+a.code+"] "+L["error_"+a.code]+e,!0)}}$data._record&&recordEvent(a)}function welcome(){playBGM("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),addTimeout(function(){$("#Intro").hide()},2e3),isWelcome=!0}function getKickText(a,e){var t=L.agree+" "+e.Y+", "+L.disagree+" "+e.N+L.kickCon;return e.Y>=e.N?t+=(a.title||a.name)+L.kicked:t+=(a.title||a.name)+L.kickDenied,t}function runCommand(a){var e,t,o={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(a[0].toLowerCase()){case"/ㄱ":case"/r":$data.room&&($data.room.master==$data.id?$stage.menu.start.trigger("click"):$stage.menu.ready.trigger("click"));break;case"/청소":case"/cls":clearChat();break;case"/ㄹ":case"/f":showDialog($stage.dialog.chatLog),$stage.chatLog.scrollTop(999999999);break;case"/귓":case"/ㄷ":case"/e":sendWhisper(a[1],a.slice(2).join(" "));break;case"/답":case"/ㄷㄷ":case"/ee":$data._recentFrom?sendWhisper($data._recentFrom,a.slice(1).join(" ")):notice(L.error_425);break;case"/무시":case"/wb":toggleWhisperBlock(a[1]);break;case"/차단":case"/shut":toggleShutBlock(a.slice(1).join(" "));break;case"/id":if(a[1]){for(e in t=0,a[1]=a.slice(1).join(" "),$data.users)($data.users[e].profile.title||$data.users[e].profile.name)==a[1]&&notice("["+ ++t+"] "+e);t||$.post("/searchnick/"+decodeURI(a[1]),function(a){a.error?notice(L.error_405):notice("["+ ++t+"] "+a.id)})}else notice(L.myId+$data.id);break;default:for(e in o)notice(o[e],e)}}function sendWhisper(a,e){e.length&&($data._whisper=a,send("talk",{whisper:a,value:e},!0),chat({title:"→"+a},e,!0))}function toggleWhisperBlock(a){$data._wblock.hasOwnProperty(a)?(delete $data._wblock[a],notice(a+L.wnblocked)):($data._wblock[a]=!0,notice(a+L.wblocked))}function toggleShutBlock(a){$data._shut.hasOwnProperty(a)?(delete $data._shut[a],notice(a+L.userNShut)):($data._shut[a]=!0,notice(a+L.userShut))}function tryDict(a,e){var t=(a=a.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,"")).match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";if(a.length<1)return e({error:404});$.get("/dict/"+a+"?lang="+t,e)}function processRoom(a){var e,t,o,r;if(a.myRoom=$data.place==a.room.id||a.target==$data.id,a.myRoom){if($target=$data.users[a.target],a.kickVote&&(notice(getKickText($target.profile,a.kickVote)),$target.id==a.id&&akAlert(L.hasKicked,!0)),-1==a.room.players.indexOf($data.id))$data.room&&$data.room.gaming&&(stopAllSounds(),$data.practicing=!1,$data._gaming=!1,$stage.box.room.height(360),playBGM("lobby")),$data.users[$data.id].game.ready=!1,$data.users[$data.id].game.team=0,$data.users[$data.id].game.form="J",$stage.menu.spectate.removeClass("toggled"),$stage.menu.ready.removeClass("toggled"),$data.room=null,$data.resulting=!1,$data._players=null,$data._master=null,$data.place=0,a.room.practice&&(delete $data.users[0],$data.room=$data._room,$data.place=$data._place,$data.master=$data.__master,$data._players=$data.__players,delete $data._room);else if(a.room.practice&&!$data.practicing&&($data.practicing=!0,$data._room=$data.room,$data._place=$data.place,$data.__master=$data.master,$data.__players=$data._players),$data.room&&($data._players=$data.room.players.toString(),$data._master=$data.room.master,$data._rTitle=$data.room.title,$data._rMode=getOptions($data.room.mode,$data.room.opts,!0),$data._rLimit=$data.room.limit,$data._rRound=$data.room.round,$data._rTime=$data.room.time),$data.room=a.room,$data.place=$data.room.id,$data.master=$data.room.master==$data.id,a.spec&&a.target==$data.id){if($data._spectate||($data._spectate=!0,clearBoard(),drawRound()),a.boards){for(e in $data.selectedRound=1,a.prisoners)for(t in o=e.split(","),a.boards[o[0]])if((r=a.boards[o[0]][t])[0]==o[1]&&r[1]==o[2]&&r[2]==o[3]){r[4]=a.prisoners[e];break}$lib.Crossword.roundReady(a,!0),$lib.Crossword.turnStart(a,!0)}for(e in a.spec)$data.users[e].game.score=a.spec[e]}a.modify||a.target!=$data.id||forkChat()}if(a.target&&$data.users[a.target]&&(-1==a.room.players.indexOf(a.target)?$data.users[a.target].place=0:$data.users[a.target].place=a.room.id),!a.room.practice)if(a.room.players.length)for(e in $data.setRoom(a.room.id,a.room),a.room.readies)$data.users[e]&&($data.users[e].game.ready=a.room.readies[e].r,$data.users[e].game.team=a.room.readies[e].t);else $data.setRoom(a.room.id,null)}function getOnly(){return $data.place?$data.room.gaming||$data.resulting?"for-gaming":$data.master?"for-master":"for-normal":"for-lobby"}function updateUI(a,e){var t,o=getOnly();if($data._replay){if(void 0!==a&&!a)return;replayStop()}if(!$data._replay&&("for-gaming"!=o||a)){for(t in $data.practicing&&(o="for-gaming"),$(".kkutu-menu button").hide(),$stage.box)$stage.box[t].hide();$stage.box.me.show(),$stage.box.chat.show().width(790).height(190),$stage.chat.height(120),"for-lobby"==o?($data._ar_first=!0,mobile?$stage.menu.userList.hasClass("toggled")?$stage.box.userList.show():$stage.box.userList.hide():$stage.box.userList.show(),$data._shop?($stage.box.roomList.hide(),$stage.box.shop.show()):($stage.box.roomList.show(),$stage.box.shop.hide()),updateUserList(e||o!=$data._only),updateRoomList(e||o!=$data._only),"nonick"!=$data.nick&&updateMe(),$data._jamsu&&(clearTimeout($data._jamsu),delete $data._jamsu)):"for-master"==o||"for-normal"==o?($(".team-chosen").removeClass("team-chosen"),$data.users[$data.id].game.ready||"S"==$data.users[$data.id].game.form?($stage.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):($stage.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+$data.users[$data.id].game.team).addClass("team-chosen"),$data.opts.ar&&$data._ar_first&&($stage.menu.ready.addClass("toggled"),$stage.menu.ready.trigger("click"),$data._ar_first=!1)),$data._shop=!1,$stage.box.room.show().height(360),"for-master"==o&&$stage.dialog.inviteList.is(":visible")&&updateUserList(),updateRoom(!1),"nonick"!=$data.nick&&updateMe()):"for-gaming"==o&&($data._gAnim&&($stage.box.room.show(),$data._gAnim=!1),$data._shop=!1,$data._ar_first=!0,$stage.box.me.hide(),$stage.box.game.show(),$(".ChatBox").width(1e3).height(140),$stage.chat.height(70),updateRoom(!0)),$data._only=o,setLocation($data.place),$(".kkutu-menu ."+o).show()}}function animModified(a){$(a).addClass("room-head-modified"),addTimeout(function(){$(a).removeClass("room-head-modified")},3e3)}function checkRoom(a){if($data._players&&$data.room){var e,t,o={}+"",r=$data._players.split(",");r.length,$data.room.players.length;for(e in r)r[e]==o&&0;for(e in $data.room.players)$data.room.players[e].robot&&0;if(a){for(e in r)r[e]!=o&&($data.users[r[e]].game.ready=!1);notice(L.hasModified)}$data._gaming!=$data.room.gaming&&($data.room.gaming?(gameReady(),$data._replay=!1,startRecord($data.room.game.title)):($data._spectate?($stage.dialog.resultSave.hide(),$data._spectate=!1,playBGM("lobby")):($stage.dialog.resultSave.show(),$data.resulting=!0),clearInterval($data._tTime))),$data._master!=$data.room.master&&notice(((t=$data.users[$data.room.master]).profile.title||t.profile.name)+L.hasMaster),$data._players=$data.room.players.toString(),$data._master=$data.room.master,$data._gaming=$data.room.gaming}}function updateMe(){var a,e,t=$data.users[$data.id],o=0,r=getLevel(t.data.score),d=EXP[r-2]||0,i=EXP[r-1];for(a in t.data.rankPoint<100?e="UNRANKED":t.data.rankPoint>=100&&t.data.rankPoint<1e3?e="BRONZE":t.data.rankPoint>=1e3&&t.data.rankPoint<5e3?e="SILVER":t.data.rankPoint>=5e3&&t.data.rankPoint<1e4?e="GOLD":t.data.rankPoint>=1e4&&t.data.rankPoint<2e4?e="RUBY":t.data.rankPoint>=2e4&&t.data.rankPoint<3e4?e="PLATINUM":t.data.rankPoint>=3e4&&t.data.rankPoint<5e4?e="DIAMOND":t.data.rankPoint>=5e4&&(e="MASTER"),t.data.record)o+=t.data.record[a][1];renderMoremi(".my-image",t.equip),$(".my-stat-level").replaceWith(getLevelImage(t.data.score).addClass("my-stat-level")),$(".my-stat-name").html(t.profile.title||t.profile.name),$(".my-stat-record").html(L.globalWin+" "+o+L.W),$(".my-stat-ping").html(commify(t.money)+L.ping),$(".my-rank").html(L[e]),$(".my-rankPoint").html(t.data.rankPoint+L.LP),$(".my-okg .graph-bar").width($data._playTime%6e5/6e3+"%"),$(".my-okg-text").html(prettyTime($data._playTime)),$(".my-level").html(L.LEVEL+" "+r),$(".my-gauge .graph-bar").width((t.data.score-d)/(i-d)*190),$(".my-gauge-text").html(commify(t.data.score)+" / "+commify(i))}function prettyTime(a){var e=Math.floor(a/6e4)%60,t=Math.floor(.001*a)%60,o=Math.floor(a/36e5),r=[];return o&&r.push(o+L.HOURS),e&&r.push(e+L.MINUTE),o||r.push(t+L.SECOND),r.join(" ")}function updateUserList(a){var e,t,o,r=0;if($data.opts.su){for(e in o=[],$data.users)r++,o.push($data.users[e]);o.sort(function(a,e){return e.data.score-a.data.score}),a=!0}else for(e in o=$data.users,$data.users)r++;if($stage.lobby.userListTitle.html("<i class='kd kd-users'></i>&lt;<b>"+L["server_"+$data.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+r+L.MN+"]"),a)for(e in $stage.lobby.userList.empty(),$stage.dialog.inviteList.empty(),o)(t=o[e]).robot||($stage.lobby.userList.append(userListBar(t)),0==t.place&&$stage.dialog.inviteList.append(userListBar(t,!0)))}function userListBar(a,e){var t;return addonNickname(t=e?$("<div>").attr("id","invite-item-"+a.id).addClass("invite-item users-item").append(getLevelImage(a.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(a.profile.title||a.profile.name)).on("click",function(a){requestInvite($(a.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+a.id).addClass("users-item").append(getLevelImage(a.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(a.profile.title||a.profile.name)).on("click",function(a){requestProfile($(a.currentTarget).attr("id").slice(11))}),a),t}function addonNickname(a,e){switch(e.equip.NIK&&a.addClass("x-"+e.equip.NIK),e.equip.BDG){case"b1_gm":a.addClass("x-gm");break;case"b1_personnel":a.addClass("x-personnel");break;case"b1_mod":a.addClass("x-mod");break;case"b1_word":a.addClass("x-word");break;case"b1_dev":a.addClass("x-dev");break;case"b1_media":a.addClass("x-media");break;case"b1_ad":a.addClass("x-ad");break;case"b1_forum":a.addClass("x-forum");break;case"b1_bj":a.addClass("x-bj");break;case"b1_yt":a.addClass("x-yt");break;case"b1_tw":a.addClass("x-tw")}}function updateRoomList(a){var e,t=0;if(a)for(e in $stage.lobby.roomList.empty(),$data.rooms)$stage.lobby.roomList.append(roomListBar($data.rooms[e])),t++;else for(e in $(".rooms-create").remove(),$data.rooms)t++;$stage.lobby.roomListTitle.html("<i class='kd kd-bars'></i>전체 게임방 목록 ["+t+L.GAE+"]"),t?($(".rooms-gaming").css("display",$data.opts.ow?"none":""),$(".rooms-locked").css("display",$data.opts.ou?"none":"")):$stage.lobby.roomList.append($stage.lobby.createBanner.clone().on("click",function(a){$stage.menu.newRoom.trigger("click")}))}function roomListBar(a){var e,t,o=getOptions(a.mode,a.opts);return e=$("<div>").attr("id","room-"+a.id).addClass("rooms-item").append(t=$("<div>").addClass("rooms-channel channel-"+a.channel).on("click",function(e){requestRoomInfo(a.id)})).append($("<div>").addClass("rooms-number").html(a.id)).append($("<div>").addClass("rooms-title ellipse").text(badWords(a.title))).append($("<div>").addClass("rooms-limit").html(a.players.length+" / "+a.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(o.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+a.round)).append($("<div>").addClass("rooms-time").html(a.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(a.password?"<i class='kd kd-lock'></i>":"<i class='kd kd-unlock-alt'></i>")).on("click",function(a){a.target!=t.get(0)&&tryJoin($(a.currentTarget).attr("id").slice(5))}),a.opts.onlybeginner?e.addClass("rooms-beginner"+(a.gaming?"-gaming":"")):a.rs.broadcaster?e.addClass("rooms-broadcaster"+(a.gaming?"-gaming":"")):a.rs.gm?e.addClass("rooms-admin"+(a.gaming?"-gaming":"")):a.gaming?e.addClass("rooms-gaming"):a.gaming&&e.addClass("rooms-gaming-original"),a.password&&e.addClass("rooms-locked"),e}function normalGameUserBar(a){var e,t,o,r=$("<div>").attr("id","game-user-"+a.id).addClass("game-user").append(e=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(getLevelImage(a.data.score).addClass("game-user-level")).append(o=$("<div>").addClass("game-user-name ellipse").html(a.profile.title||a.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+getLevel(a.data.score)))).append(t=$("<div>").addClass("game-user-score"));return renderMoremi(e,a.equip),global.expl(r),addonNickname(o,a),a.game.team&&t.addClass("team-"+a.game.team),r}function miniGameUserBar(a){var e,t,o=$("<div>").attr("id","game-user-"+a.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(getLevelImage(a.data.score).addClass("game-user-level")).append(t=$("<div>").addClass("game-user-name ellipse").html(a.profile.title||a.profile.name))).append(e=$("<div>").addClass("game-user-score"));return a.id==$data.id&&t.addClass("game-user-my-name"),addonNickname(t,a),a.game.team&&e.addClass("team-"+a.game.team),o}function getAIProfile(a){return{title:L["aiLevel"+a]+" "+L.robot,image:CDN+"/img/kkutu/robot.png"}}function updateRoom(a){var e,t,o,r,d,i,s,n=RULE[MODE[$data.room.mode]],l=mobile||n.big?miniGameUserBar:normalGameUserBar,c=!1,m=!0;if(setRoomHead($(".RoomBox .product-title"),$data.room),setRoomHead($(".GameBox .product-title"),$data.room),a){for(e in o=$(".GameBox .game-body").empty(),$data.room.game.seq)(t=$data._replay?$rec.users[$data.room.game.seq[e]]||$data.room.game.seq[e]:$data.users[$data.room.game.seq[e]]||$data.robots[$data.room.game.seq[e].id]||$data.room.game.seq[e]).robot&&!t.profile&&(t.profile=getAIProfile(t.level),$data.robots[t.id]=t),o.append(l(t)),updateScore(t.id,t.game.score||0);clearTimeout($data._jamsu),delete $data._jamsu}else{for(e in o=$(".room-users").empty(),g="S"==$data.users[$data.id].game.form,$data.room.players)if((t=$data.users[$data.room.players[e]]||$data.room.players[e]).game){var u=t.game.practice?"/"+L.stat_practice:"",g="S"==t.game.form&&"/"+L.stat_spectate;t.robot&&(t.profile=getAIProfile(t.level),$data.robots[t.id]=t),o.append($("<div>").attr("id","room-user-"+t.id).addClass("room-user").append(i=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(r=$("<div>").addClass("room-user-ready")).append(d=$("<div>").addClass("room-user-team team-"+t.game.team).html($("#team-"+t.game.team).html()))).append($("<div>").addClass("room-user-title").append(getLevelImage(t.data.score).addClass("room-user-level")).append(s=$("<div>").addClass("room-user-name").html(t.profile.title||t.profile.name))).on("click",function(a){requestProfile($(a.currentTarget).attr("id").slice(10))})),renderMoremi(i,t.equip),g&&d.hide(),t.id==$data.room.master?r.addClass("room-user-master").html(L.master+u+(g||"")):g?r.addClass("room-user-spectate").html(L.stat_spectate+u):t.game.ready||t.robot?(r.addClass("room-user-readied").html(L.stat_ready),t.robot||(c=!0)):t.game.practice?(r.addClass("room-user-practice").html(L.stat_practice),m=!1):(r.html(L.stat_noready),m=!1),addonNickname(s,t)}c&&$data.room.master==$data.id&&m?$data._jamsu||($data._jamsu=addTimeout(onMasterSubJamsu,5e3)):(clearTimeout($data._jamsu),delete $data._jamsu)}$stage.dialog.profile.is(":visible")&&requestProfile($data._profiled)}function onMasterSubJamsu(){notice(L.subJamsu),$data._jamsu=addTimeout(function(){send("leave"),akAlert(L.masterJamsu,!0)},3e4)}function updateScore(a,e){var t;return(t=$data["_s"+a])?(clearTimeout(t.timer),t.$obj=$("#game-user-"+a+" .game-user-score"),t.goal=e):t=$data["_s"+a]={$obj:$("#game-user-"+a+" .game-user-score"),goal:e,now:0},animateScore(t),$("#game-user-"+a)}function animateScore(a){var e=(a.goal-a.now)*Math.min(1,.01*TICK);e<.1?e=a.goal-a.now:a.timer=addTimeout(animateScore,TICK,a),a.now+=e,drawScore(a.$obj,Math.round(a.now))}function drawScore(a,e){var t,o=e>99999?zeroPadding(Math.round(.001*e),4)+"k":zeroPadding(e,5);for(a.empty(),t=0;t<o.length;t++)a.append($("<div>").addClass("game-user-score-char").html(o[t]))}function drawMyDress(a){var e=$("#dress-view"),t=$data.users[$data.id];renderMoremi(e,t.equip),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-exordial").val(t.exordial),$("#dress-nick").val(t.nick),drawMyGoods(a||!0)}function renderGoods(a,e,t,o,r){var d,i,s,n,l,c,m=[],u=!0===t;for(c in a.empty(),o||(o={}),o)$data.box.hasOwnProperty(o[c])||($data.box[o[c]]={value:0});for(c in $data.box)m.push({key:c,obj:iGoods(c),value:$data.box[c]});for(c in m.sort(function(a,e){return a.obj.name<e.obj.name?-1:1}),m)i=m[c].obj,s=m[c].value,"BDG"==(n=i.group).substr(0,3)&&(n="BDG"),l="Mhand"==n?o.Mlhand==m[c].key||o.Mrhand==m[c].key:o[n]==m[c].key,"number"==typeof s&&(s={value:s}),(s.hasOwnProperty("value")||l)&&(u||-1!=t.indexOf(i.group))&&(a.append(d=$("<div>").addClass("dress-item").append(getImage(i.image).addClass("dress-item-image").html("x"+s.value)).append(explainGoods(i,l,s.expire))),d.attr("id",e+"-"+i._id).on("click",r),l&&d.addClass("dress-equipped"));global.expl(a)}function drawMyGoods(a){var e,t=$data.users[$data.id].equip||{},o=!0===a;$data._avGroup=a,e=!!o||(a||"").split(","),renderGoods($("#dress-goods"),"dress",e,t,function(a){var e=$(a.currentTarget),t=e.attr("id").slice(6),o=iGoods(t);if(a.ctrlKey){if(e.hasClass("dress-equipped"))return fail(426);akConfirm(L.surePayback+commify(Math.round(.2*(o.cost||0)))+L.ping,function(a){a&&$.post("/payback/"+t,function(a){if(a.error)return fail(a.error);akAlert(L.painback),$data.box=a.box,$data.users[$data.id].money=a.money,drawMyDress($data._avGroup),updateUI(!1)})},!0)}else-1!=AVAIL_EQUIP.indexOf(o.group)?"Mhand"==o.group?akPrompt.whichHand(L.dressWhichHand,function(a){a&&("left"==a&&requestEquip(t,!0),"right"==a&&requestEquip(t,!1))}):requestEquip(t,void 0):"CNS"==o.group&&akConfirm(L.sureConsume,function(a){a&&$.post("/consume/"+t,function(a){a.exp&&notice(L.obtainExp+": "+commify(a.exp)),a.money&&notice(L.obtainMoney+": "+commify(a.money)),a.gain.forEach(function(a){queueObtain(a)}),$data.box=a.box,$data.users[$data.id].data=a.data,send("refresh"),drawMyDress($data._avGroup),updateMe()})},!0)})}function requestEquip(a,e,t){var o=$data.users[$data.id],r=$data.shop[a].group;"Mhand"==r&&(r=e?"Mlhand":"Mrhand"),"BDG"==r.substr(0,3)&&(r="BDG");var d=o.equip[r]==a;t?$.post("/equip/"+a,{isLeft:e},function(a){if(a.error)return fail(a.error);$data.box=a.box,o.equip=a.equip,drawMyDress($data._avGroup),send("refresh"),updateUI(!1)}):akConfirm(L[d?"sureUnequip":"sureEquip"]+": "+L["item_"+a],function(t){t&&$.post("/equip/"+a,{isLeft:e},function(a){if(a.error)return fail(a.error);$data.box=a.box,o.equip=a.equip,drawMyDress($data._avGroup),send("refresh"),updateUI(!1)})},!0)}function drawCharFactory(){var a=$("#cf-tray"),e=$("#cf-dict"),t=$("#cf-reward"),o=$("#cf-goods"),r=$("#cf-cost");function d(){a.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function i(){var o,i={WPC:1,WPB:2,WPA:3},n="",l=0;a.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),$data._tray.forEach(function(e){o=iGoods(e),n+=e.slice(4),l+=i[e.slice(1,4)],o.image&&a.append($("<div>").addClass("jt-image").css("background-image","url("+o.image+")").attr("id","cf-tray-"+e).on("click",s)),$("#cf-\\"+e).addClass("cf-tray-selected")}),e.html(L.searching),t.empty(),$stage.dialog.cfCompose.removeClass("cf-composable"),r.html(""),tryDict(n,function(a){var o=!1;if(a.error){if(3!=n.length)return e.html(L["wpFail_"+a.error]);o=!0,e.html(L.cfBlend)}!function(a,e,o){$.get("/cf/"+a+"?l="+e+"&b="+(o?"1":""),function(a){if(a.error)return fail(a.error);t.empty(),a.data.forEach(function(a){var e=iGoods(a.key),o=a.rate>=1?L.cfRewAlways:(100*a.rate).toFixed(1)+"%";t.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+e.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(e.name)).append($("<div>").addClass("cf-rew-value").html("x"+a.value))).append($("<div>").addClass("cf-rew-rate").html(o)))}),r.html(L.cfCost+": "+a.cost+L.ping)})}(n,l,o),$stage.dialog.cfCompose.addClass("cf-composable"),a.error||e.html(processWord(a.word,a.mean,a.theme,a.type.split(",")))}),""==n&&d()}function s(a){var e=$(a.currentTarget).attr("id").slice(8),t=$data._tray.indexOf(e);-1!=t&&($data._tray.splice(t,1),i())}$data._tray=[],e.empty(),t.empty(),r.html(""),$stage.dialog.cfCompose.removeClass("cf-composable"),renderGoods(o,"cf",["PIX","PIY","PIZ"],null,function(a){var e,t=$(a.currentTarget).attr("id").slice(3),o=$data.box[t],r=0;if($data._tray.length>=6)return fail(435);for(e in $data._tray)$data._tray[e]==t&&r++;o-r>0?($data._tray.push(t),i()):fail(434)}),d()}function drawLeaderboard(a){var e=$stage.dialog.lbTable.empty(),t=a.data[0]?a.data[0].rank:0,o=(a.page||Math.floor(t/20))+1;a.data.forEach(function(a,t){var o=$data.users[a.id];o=o?o.profile.title||o.profile.name:L.hidden,a.score=Number(a.score),e.append($("<tr>").attr("id","ranking-"+a.id).addClass("ranking-"+(a.rank+1)).append($("<td>").html(a.rank+1)).append($("<td>").append(getLevelImage(a.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html(getLevel(a.score)))).append($("<td>").html(o)).append($("<td>").html(commify(a.score))))}),$("#ranking-"+$data.id).addClass("ranking-me"),$stage.dialog.lbPage.html(L.page+" "+o),$stage.dialog.lbPrev.attr("disabled",o<=1),$stage.dialog.lbNext.attr("disabled",a.data.length<15),$stage.dialog.lbMe.attr("disabled",!!$data.guest),$data._lbpage=o-1}function updateCommunity(){var a,e,t,o,r=0;for(a in $stage.dialog.commFriends.empty(),$data.friends)r++,o=$data.friends[a],e=$data._friends[a]||{},t=($data.users[a]||{}).profile,$stage.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+a).append($("<div>").addClass("cfi-status cfi-stat-"+(e.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(e.server?L["server_"+e.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(t?t.title||t.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(o)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("kd kd-edit").on("click",d)).append($("<i>").addClass("kd kd-user-times").on("click",i))));function d(a){var e=$(a.currentTarget).parent().parent().attr("id").slice(4);$data.friends[e];akPrompt(L.friendEditMemo,function(a){a&&send("friendEdit",{id:e,memo:a},!0)})}function i(a){var e=$(a.currentTarget).parent().parent().attr("id").slice(4),t=$data.friends[e];if(t.server)return fail(455);akConfirm(t+"(#"+e.substr(0,5)+")\n"+L.friendSureRemove,function(a){a&&send("friendRemove",{id:e},!0)},!0)}$("#CommunityDiag .dialog-title").html(L.communityText+" ("+r+" / 100)")}function requestRoomInfo(a){var e=$data.rooms[a],t=$("#ri-players").empty();$data._roominfo=a,$("#RoomInfoDiag .dialog-title").html(a+L.sRoomInfo),$("#ri-title").html((e.password?"<i class='kd kd-lock'></i>&nbsp;":"")+e.title),$("#ri-mode").html(L["mode"+MODE[e.mode]]),$("#ri-round").html(e.round+", "+e.time+L.SECOND),$("#ri-limit").html(e.players.length+" / "+e.limit),e.players.forEach(function(a,o){var r,d,i=e.readies[a]||{};a=$data.users[a]||NULL_USER,e.players[o].robot?(a.profile={title:L.robot},a.equip={robot:!0}):i.t=i.t||0,t.append($("<div>").addClass("ri-player").append(d=$("<div>").addClass("moremi rip-moremi")).append(r=$("<div>").addClass("ellipse rip-title").html(a.profile.title||a.profile.name)).append($("<div>").addClass("rip-team team-"+i.t).html($("#team-"+i.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+i.f]))),a.id==e.master&&r.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),r.prepend(getLevelImage(a.data.score).addClass("profile-level rip-level")),renderMoremi(d,a.equip)}),showDialog($stage.dialog.roomInfo),$stage.dialog.roomInfo.show()}function requestProfile(a){var e,t,o,r,d=$data.users[a]||$data.robots[a],i=$("#profile-record").empty(),s=$data.users[a];if(d){if($("#ProfileDiag .dialog-title").html((d.profile.title||d.profile.name)+L.sProfile),$(".profile-head").empty().append(e=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append($("<div>").addClass("profile-title ellipse").html(d.profile.title||d.profile.name).append($("<label>").addClass("profile-tag").html(" #"+d.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").append(getLevelImage(d.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(o=getLevel(d.data.score)))).append($("<div>").addClass("profile-score-text").html(commify(d.data.score)+" / "+commify(EXP[o-1])+L.PTS))).append(t=$("<div>").addClass("profile-head-item profile-exordial ellipse").text(badWords(d.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(d.exordial))),d.robot)$stage.dialog.profileLevel.show(),$stage.dialog.profileLevel.prop("disabled",$data.id!=$data.room.master),$("#rank").html(L.UNRANKED),$("#rankpoint").html(L["0LP"]),$("#profile-place").html($data.room.id+L.roomNumber);else{for(o in $stage.dialog.profileLevel.hide(),$("#profile-place").html(d.place?d.place+L.roomNumber:L.lobby),$("#rank").html(L[r]),s.data.rankPoint<100?r="UNRANKED":s.data.rankPoint>=100&&s.data.rankPoint<1e3?r="BRONZE":s.data.rankPoint>=1e3&&s.data.rankPoint<5e3?r="SILVER":s.data.rankPoint>=5e3&&s.data.rankPoint<1e4?r="GOLD":s.data.rankPoint>=1e4&&s.data.rankPoint<2e4?r="RUBY":s.data.rankPoint>=2e4&&s.data.rankPoint<3e4?r="PLATINUM":s.data.rankPoint>=3e4&&s.data.rankPoint<5e4?r="DIAMOND":s.data.rankPoint>=5e4&&(r="MASTER"),$("#rankpoint").html(s.data.rankPoint+L.LP),d.data.record){var n=d.data.record[o];if(0!=n[0])var l=(n[1]/n[0]*100).toFixed(2);else l="0.00";i.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+o])).append($("<div>").addClass("profile-field-record").html(n[0]+L.P+" "+n[1]+L.W)).append($("<div>").addClass("profile-field-percent").html(String(l)+"%")).append($("<div>").addClass("profile-field-score").html(commify(n[2])+L.PTS)))}renderMoremi(e,d.equip)}$data._profiled=a,$stage.dialog.profileKick.hide(),$stage.dialog.profileShut.hide(),$stage.dialog.profileDress.hide(),$stage.dialog.profileWhisper.hide(),$stage.dialog.profileHandover.hide(),$stage.dialog.profileReport.hide(),$data.id==a?$stage.dialog.profileDress.show():d.robot||($stage.dialog.profileShut.show(),$stage.dialog.profileWhisper.show(),$stage.dialog.profileReport.show()),$data.room&&$data.id!=a&&$data.id==$data.room.master&&($stage.dialog.profileKick.show(),$stage.dialog.profileHandover.show()),showDialog($stage.dialog.profile),$stage.dialog.profile.show(),global.expl(t)}else notice(L.error_405)}function requestInvite(a){var e;"AI"!=a?(e=$data.users[a].profile.title||$data.users[a].profile.name,akConfirm(e+L.sureInvite,function(e){e&&send("invite",{target:a})},!0)):send("invite",{target:a})}function checkFailCombo(a){$data._replay||$data.lastFail!=$data.id||$data.id!=a?$data.failCombo=0:($data.failCombo++,1==$data.failCombo&&notice(L.trollWarning),$data.failCombo>1&&(send("leave"),fail(437))),$data.lastFail=a}function clearGame(){$data._spaced&&$lib.Typing.spaceOff(),clearInterval($data._tTime),$data._relay=!1}function gameReady(){var a;for(a in $data.room.players)($data._replay?$rec.users[$data.room.players[a]]||$data.room.players[a]:$data.users[$data.room.players[a]]||$data.robots[$data.room.players[a].id]).game.score=0,delete $data["_s"+$data.room.players[a]];delete $data.lastFail,$data.failCombo=0,$data._spectate=-1==$data.room.game.seq.indexOf($data.id),$data._gAnim=!0,$stage.box.room.show().height(360).animate({height:1},500),$stage.box.game.height(1).animate({height:410},500),stopBGM(),$stage.dialog.resultSave.attr("disabled",!1),clearBoard(),$stage.game.display.html(L.soon),playSound("game_start"),forkChat(),addTimeout(function(){$stage.box.room.height(360).hide(),$stage.chat.scrollTop(999999999)},500)}function replayPrevInit(){var a;for(a in $data.room.game.seq)$data.room.game.seq[a].robot&&($data.room.game.seq[a].game.score=0);for(a in $rec.users={},$rec.players){var e=$rec.players[a].id,t=$rec.readies[e]||{},o=$data.users[e]||$data.robots[e],r=e;$rec.players[a].robot?(o=$rec.users[e]={robot:!0},(r=$rec.players[a]).game={}):o=$rec.users[e]={},$data.room.players.push(r),o.id=r,o.profile=$rec.players[a],o.data=o.profile.data,o.equip=o.profile.equip,o.game={score:0,team:t.t}}$data._rf=0}function replayReady(){var a;for(a in replayStop(),$data._replay=!0,$data.room={title:$rec.title,players:[],events:[],time:$rec.roundTime,round:$rec.round,mode:$rec.mode,limit:$rec.limit,game:$rec.game,opts:$rec.opts,readies:$rec.readies},replayPrevInit(),$rec.events)$data.room.events.push($rec.events[a]);$stage.box.userList.hide(),$stage.box.roomList.hide(),$stage.box.game.show(),$stage.dialog.replay.hide(),gameReady(),updateRoom(!0),$data.$gp=$(".GameBox .product-title").empty().append($data.$gpt=$("<div>").addClass("game-replay-title")).append($data.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",replayNext)).append($("<button>").html(L.replayPause).on("click",replayPause)).append($("<button>").html(L.replayPrev).on("click",replayPrev))),$data._gpp=L.replay+" - "+new Date($rec.time).toLocaleString(),$data._gtt=$data.room.events[$data.room.events.length-1].time,$data._eventTime=0,$data._rt=addTimeout(replayTick,2e3),$data._rprev=0,$data._rpause=!1,replayStatus()}function replayPrev(a){var e,t,o=$data.room.events[--$data._rf];if(o){e=o.time;do{if(!(o=$data.room.events[--$data._rf]))break}while(e-o.time<1e3);for(t=$data._rf-1,replayPrevInit(),e=$data.muteEff,$data.muteEff=!0,i=0;i<t;i++)replayTick();$(".deltaScore").remove(),$data.muteEff=e,replayTick()}}function replayPause(a){var e=$data._rpause=!$data._rpause;$(a.target).html(e?L.replayResume:L.replayPause)}function replayNext(a){clearTimeout($data._rt),replayTick()}function replayStatus(){$data.$gpt.html($data._gpp+" ("+(.001*$data._eventTime).toFixed(1)+L.SECOND+" / "+(.001*$data._gtt).toFixed(1)+L.SECOND+")")}function replayTick(a){var e,t=$data.room.events[$data._rf];if(clearTimeout($data._rt),a||$data._rf++,t){if($data._rpause)return $data._rf--,$data._rt=addTimeout(replayTick,100);(e=t.data).hint&&(e.hint={_id:e.hint}),"chat"==e.type&&(e.timestamp=$rec.time+t.time),onMessage(e),$data._eventTime=t.time,replayStatus(),$data.room.events.length>$data._rf?$data._rt=addTimeout(replayTick,$data.room.events[$data._rf].time-t.time):replayStop()}else replayStop()}function replayStop(){delete $data.room,$data._replay=!1,$stage.box.room.height(360),clearTimeout($data._rt),updateUI(),playBGM("lobby")}function startRecord(a){var e,t;for(e in $rec={version:$data.version,me:$data.id,players:[],events:[],title:$data.room.title,roundTime:$data.room.time,round:$data.room.round,mode:$data.room.mode,limit:$data.room.limit,game:$data.room.game,opts:$data.room.opts,readies:$data.room.readies,time:(new Date).getTime()},$data.room.players){var o;o={id:(t=$data.users[$data.room.players[e]]||$data.room.players[e]).id,score:0},t.robot?(o.id=t.id,o.robot=!0,o.data={score:0},t={profile:getAIProfile(t.level)}):(o.data=t.data,o.equip=t.equip),o.title="#"+t.id,$rec.players.push(o)}$data._record=!0}function stopRecord(){$data._record=!1}function recordEvent(a){if(!$data._replay&&$rec){var e,t=a;if(a.hasOwnProperty("type")&&"room"!=a.type&&"obtain"!=a.type){for(e in a={},t)a[e]=t[e];a.profile&&(a.profile={id:a.profile.id,title:"#"+a.profile.id}),a.user&&(a.user={id:a.user.profile.id,profile:{id:a.user.profile.id,title:"#"+a.user.profile.id},data:{score:0},equip:{}}),$rec.events.push({data:a,time:(new Date).getTime()-$rec.time})}}}function clearBoard(){$data._relay=!1,loading(),$stage.game.here.hide(),$stage.dialog.result.hide(),$stage.dialog.dress.hide(),$stage.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),$(".jjoriping,.rounds").removeClass("dg"),$(".rounds").removeClass("painter"),$stage.game.display.empty(),$stage.game.chain.hide(),$stage.game.hints.empty().hide(),$stage.game.tools.hide(),$stage.game.cwcmd.hide(),$stage.game.bb.hide(),$stage.game.round.empty(),$stage.game.history.empty(),$stage.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function drawRound(a){var e;for($stage.game.round.empty(),e=0;e<$data.room.round;e++)$stage.game.round.append($l=$("<label>").html($data.room.game.title[e])),e+1==a&&$l.addClass("rounds-current")}function turnGoing(){route("turnGoing")}function turnHint(a){route("turnHint",a)}function turnError(a,e){$stage.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+a]?L["turnError_"+a]+": ":"")+e)),playSound("fail"),clearTimeout($data._fail),$data._fail=addTimeout(function(){$stage.game.display.html($data._char)},1800)}function getScore(a){return $data._replay?$rec.users[a].game.score:($data.users[a]||$data.robots[a]).game.score}function addScore(a,e){$data._replay?$rec.users[a].game.score+=e:($data.users[a]||$data.robots[a]).game.score+=e}function drawObtainedScore(a,e){return a.append(e),addTimeout(function(){e.remove()},2e3),a}function turnEnd(a,e){route("turnEnd",a,e)}function roundEnd(a,e){var t,o,r;e||(e={});var d,i,s,n,l,c,m=$(".result-board").empty();for(t in $(".result-me-expl").empty(),$stage.game.display.html(L.roundEnd),$data._resultPage=1,$data._result=null,$data._relay=!1,a)r=a[t],(o=$data._replay?$rec.users[r.id]:$data.users[r.id])||(o=NULL_USER),o.data&&r.reward&&(r.reward.score=$data._replay?0:Math.round(r.reward.score),s=getLevel(n=o.data.score)>getLevel(o.data.score-r.reward.score),m.append(d=$("<div>").addClass("result-board-item").append(i=$("<div>").addClass("result-board-rank").html(r.rank+1)).append(getLevelImage(n).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(e.scores?L.avg+" "+commify(e.scores[r.id])+L.kpm:commify(r.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(r.reward.score?"+"+commify(r.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",s?"block":"none").append($("<i>").addClass("kd kd-arrow-up")).append($("<div>").html(L.lvUp)))),o.game.team&&i.addClass("team-"+o.game.team),r.id==$data.id&&(r.exp=o.data.score-r.reward.score,r.level=getLevel(r.exp),$data._result=r,d.addClass("result-board-me"),$(".result-me-expl").append(p(r.reward._score,r.reward._money,r.reward._blog))));function u(a){var e,t,o;$data._result.goal=EXP[$data._result.level-1],$data._result.before=EXP[$data._result.level-2]||0,$data._result.reward.score>0&&((e=$data._result.reward.score*$data._coef)<.05&&$data._coef&&(e=$data._result.reward.score),$data._result.reward.score-=e,$data._result.exp+=e,t=getLevel($data._result.exp),$data._result.level!=t&&($data._result._boing-=$data._result.goal-$data._result._exp,$data._result._exp=$data._result.goal,playSound("lvup")),$data._result.level=t,addTimeout(u,50)),o=$data._result.exp-$data._result._exp,g("before",$data._result._exp,$data._result.before,$data._result.goal),g("current",Math.min(o,$data._result._boing),0,$data._result.goal-$data._result.before),g("bonus",Math.max(0,o-$data._result._boing),0,$data._result.goal-$data._result.before),$(".result-me-level-body").html($data._result.level),$(".result-me-score-text").html(commify(Math.round($data._result.exp))+" / "+commify($data._result.goal))}function g(a,e,t,o){$(".result-me-"+a+"-bar").width((e-t)/(o-t)*100+"%")}function p(a,e,t){var o,r,d=$("<div>").append($("<h4>").html(L.scoreGain)).append(o=$("<div>")).append($("<h4>").html(L.moneyGain)).append(r=$("<div>"));function i(a,e,t){a.append($("<h5>").addClass("result-me-blog-head").html(e)).append($("<h5>").addClass("result-me-blog-body").html(t))}return i(o,L.scoreOrigin,a),i(r,L.moneyOrigin,e),t.forEach(function(t){var d,s,n,l=t.charAt(0),c=t.charAt(1),m=t.slice(2,5),$=Number(t.slice(5));"EXP"==m?(d=o,n=a):"MNY"==m&&(d=r,n=e),"g"==c?s="+"+(n*$).toFixed(1):"h"==c&&(s="+"+Math.floor($)),i(d,L["bonusFrom_"+l],s)}),d}$(".result-me").css("opacity",0),$data._coef=0,$data._result&&(l=$data._result.reward.score-$data._result.reward._score,c=$data._result.reward.money-$data._result.reward._money,$data._result._exp=$data._result.exp,$data._result._score=$data._result.reward.score,$data._result._bonus=l,$data._result._boing=$data._result.reward._score,$data._result._addit=l,$data._result._addp=c,l=l>0?"<label class='result-me-bonus'>(+"+commify(l)+")</label>":"",c=c>0?"<label class='result-me-bonus'>(+"+commify(c)+")</label>":"",notice(L.scoreGain+": "+commify($data._result.reward.score)+", "+L.moneyGain+": "+commify($data._result.reward.money)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+commify($data._result.reward.score)+l),$(".result-me-money").html(L.moneyGain+" +"+commify($data._result.reward.money)+c)),addTimeout(function(){showDialog($stage.dialog.result),$data._result&&u(),$stage.dialog.result.css("opacity",0).animate({opacity:1},500),addTimeout(function(){$data._coef=.05},500)},2e3),stopRecord()}function drawRanking(a){var e,t,d,s=$(".result-board").empty();if($data._resultPage=2,!a)return $stage.dialog.resultOK.trigger("click");for(i in a.list)r=a.list[i],o=$data.users[r.id]||{profile:{title:L.hidden}},d=r.id==$data.id,s.append(e=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(getLevelImage(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(commify(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(t=$("<div>").addClass("result-board-lvup").css("display",d?"block":"none").append($("<i>").addClass("kd kd-arrow-up")).append($("<div>").html(a.prev-r.rank)))),d&&(a.prev-r.rank<=0&&t.hide(),e.addClass("result-board-me"))}function kickVoting(a){var e=$data.users[a].profile;$("#kick-vote-text").html((e.title||e.name)+L.kickVoteText),$data.kickTime=10,$data._kickTime=10,$data._kickTimer=addTimeout(kickVoteTick,1e3),showDialog($stage.dialog.kickVote)}function kickVoteTick(){$(".kick-vote-time .graph-bar").width($data.kickTime/$data._kickTime*300),--$data.kickTime>0?$data._kickTimer=addTimeout(kickVoteTick,1e3):$stage.dialog.kickVoteY.trigger("click")}function loadShop(){var a=$("#shop-shelf");a.html(L.LOADING),processShop(function(e){if(a.empty(),$data.guest&&(e.error=423),e.error)return $stage.menu.shop.trigger("click"),fail(e.error);e.goods.sort(function(a,e){return e.updatedAt-a.updatedAt}).forEach(function(e,t,o){if(!(e.cost<0)){var r=iImage(!1,e);a.append($("<div>").attr("id","goods_"+e._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+r+")")).append($("<div>").addClass("goods-title").html(iName(e._id))).append($("<div>").addClass("goods-cost").html(commify(e.cost)+L.ping)).append(explainGoods(e,!1)).on("click",onGoods))}}),global.expl(a)}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}function filterShop(a){var e,t,o,r=!0===a;for(o in r||(a=a.split(",")),$data.shop)(t=$data.shop[o]).cost<0||(e=$("#goods_"+o).show(),r||-1==a.indexOf(t.group)&&e.hide())}function explainGoods(a,e,t){var o,r,d=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(iName(a._id)+(e?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+a.group])).append($("<div>").addClass("dress-item-expl").html(iDesc(a._id))),i=$("<div>").addClass("dress-item-opts");for(o in a.term&&d.append($("<div>").addClass("dress-item-term").html(Math.floor(a.term/86400)+L.DATE+" "+L.ITEM_TERM)),t&&d.append($("<div>").addClass("dress-item-term").html(new Date(1e3*t).toLocaleString()+L.ITEM_TERMED)),a.options)if("gif"!=o){var s=o.charAt(0);r=a.options[o],"g"==s?r="+"+(100*r).toFixed(1)+"%p":"h"==s&&(r="+"+r),i.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+o])).append($("<label>").addClass("item-opts-body").html(r)).append($("<br>"))}return r&&d.append(i),d}function processShop(a){var e;$.get("/shop",function(t){for(e in $data.shop={},t.goods)$data.shop[t.goods[e]._id]=t.goods[e];a&&a(t)})}function onGoods(a){var e,t,o=$(a.currentTarget).attr("id").slice(6),r=$data.shop[o],d=$data.users[$data.id],i=d.money,s=i-r.cost,n=L.surePurchase,l={};for(t in $data.box&&$data.box[o]&&(n=L.alreadyGot+" "+n),showDialog($stage.dialog.purchase,!0),$("#purchase-ping-before").html(commify(i)+L.ping),$("#purchase-ping-cost").html(commify(r.cost)+L.ping),$("#purchase-item-name").html(L["item"+o]),e=$("#purchase-ping-after").html(commify(s)+L.ping),$("#purchase-item-desc").html(s<0?L.notEnoughMoney:n),d.equip)l[t]=d.equip[t];l["Mhand"==r.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:r.group]=o,renderMoremi("#moremi-after",l),$data._sgood=o,$stage.dialog.purchaseOK.attr("disabled",s<0),s<0?e.addClass("purchase-not-enough"):e.removeClass("purchase-not-enough")}function vibrate(a){a<1||($("#Middle").css("padding-top",a),addTimeout(function(){$("#Middle").css("padding-top",0),addTimeout(vibrate,50,.7*a)},50))}function pushDisplay(a,e,t,o){var r,d,i,s,n,l=MODE[$data.room.mode],c="KKT"==l,m="KAP"==l,u=BEAT[r=a.length],g=0,p=$data.turnTime/96,h=$data.turnTime/12;if($stage.game.display.empty(),u?(d="As"+$data._speed,u=u.split("")):"en"==RULE[l].lang&&r<10?d="As"+$data._speed:(d="Al",vibrate(r)),i="K"+$data._speed,u){for(s in u)"0"!=u[s]&&($stage.game.display.append(n=$("<div>").addClass("display-text").css({float:m?"right":"left","margin-top":-6,"font-size":36}).hide().html(m?a.charAt(r-g-1):a.charAt(g))),g++,addTimeout(function(a,e){var t={"margin-top":0};playSound(e),a.html()==$data.mission?(playSound("mission"),a.css({color:"#66FF66"}),t["font-size"]=24):t["font-size"]=20,a.show().animate(t,100)},Number(s)*p,n,d));s=$stage.game.display.children("div").get(0),$(s).css(m?"margin-right":"margin-left",.5*($stage.game.display.width()-20*r))}else if(g="",m)for(s=0;s<r;s++)addTimeout(function(a){playSound(d),a==$data.mission?(playSound("mission"),g="<label style='color: #66FF66;'>"+a+"</label>"+g):g=a+g,$stage.game.display.html(g)},Number(s)*h/r,a[r-s-1]);else for(s=0;s<r;s++)addTimeout(function(a){playSound(d),a==$data.mission?(playSound("mission"),g+="<label style='color: #66FF66;'>"+a+"</label>"):g+=a,$stage.game.display.html(g)},Number(s)*h/r,a[s]);addTimeout(function(){for(s=0;s<3;s++)addTimeout(function(a){if(c){if(1==a)return;playSound("kung")}(u?$stage.game.display.children(".display-text"):$stage.game.display).css("font-size",21).animate({"font-size":20},p)},s*p*2,s);addTimeout(pushHistory,4*p,a,e,t,o),c||playSound(i)},h)}function pushHint(a){var e,t=processWord("",a);$stage.game.hints.append(e=$("<div>").addClass("hint-item").append($("<label>").html(t)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(t.html()))),mobile||e.width(0).animate({width:215}),global.expl(e)}function pushHistory(a,e,t,o){var r,d,i,s=o?o.split(","):[],n={};$stage.game.history.prepend(r=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(a)),(d=$stage.game.history.children()).length>6&&d.last().remove(),i=processWord(a,e,t,s),s.forEach(function(a){n[a]||L["class_"+a]&&(n[a]=!0,r.append($("<label>").addClass("history-class").html(L["class_"+a])))}),r.append(d=$("<div>").addClass("history-mean ellipse").append(i)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+i.html()+"</h5>")),global.expl(r)}function processNormal(a,e){return $("<label>").addClass("word").html(e)}function processWord(a,e,t,o){if(!e||-1==e.indexOf("＂"))return processNormal(a,e);var r=$("<label>").addClass("word"),d=e.split(/＂[0-9]+＂/).slice(1).map(function(a){return-1==a.indexOf("［")?[[a]]:a.split(/［[0-9]+］/).slice(1).map(function(a){return a.split(/（[0-9]+）/).slice(1)})}),i=(o&&o.map(function(a){return L["class_"+a]}),t?t.split(",").map(function(a){return L["theme_"+a]}):[]),s=d.length>1;return d.forEach(function(a,e){var t=$("<label>").addClass("word-m1"),o=a.length>1;s&&t.append($("<label>").addClass("word-head word-m1-head").html(e+1)),a.forEach(function(a,e){var r=$("<label>").addClass("word-m2"),d=a.length,s=d>1,n=i.splice(0,d);o&&r.append($("<label>").addClass("word-head word-m2-head").html(e+1)),a.forEach(function(a,e){var t=$("<label>").addClass("word-m3"),o=n.shift();s&&t.append($("<label>").addClass("word-head word-m3-head").html(e+1)),o&&t.append($("<label>").addClass("word-theme").html(o)),t.append($("<label>").addClass("word-m3-body").html(a.replace(/\$\$[^\$]+\$\$/g,function(a){var e=a.slice(2,a.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"≥");return"<equ>"+e+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>"))),r.append(t)}),t.append(r)}),r.append(t)}),r}function getCharText(a,e,t){var o=a+(e?"("+e+")":"");return t&&(o+="<label class='jjo-display-word-length'>("+t+")</label>"),o}function getRequiredScore(a){return a<=240?Math.round((.3*!(a%5)+1)*(.4*!(a%15)+1)*(.5*!(a%45)+1)*(120+60*Math.floor(a/5)+120*Math.floor(a*a/225)+180*Math.floor(a*a/2025))):a<=360?Math.round((.3*!(a%5)+1)*(.4*!(a%15)+1)*(.5*!(a%45)+1)*(120+100*Math.floor(a/5)+200*Math.floor(a*a/225)+240*Math.floor(a*a/2025))):a<=480?Math.round((.3*!(a%5)+1)*(.4*!(a%15)+1)*(.5*!(a%45)+1)*(120+140*Math.floor(a/5)+280*Math.floor(a*a/225)+300*Math.floor(a*a/2025))):a<=600?Math.round((.3*!(a%5)+1)*(.4*!(a%15)+1)*(.5*!(a%45)+1)*(120+180*Math.floor(a/5)+360*Math.floor(a*a/225)+360*Math.floor(a*a/2025))):a<=720?Math.round((.3*!(a%5)+1)*(.4*!(a%15)+1)*(.5*!(a%45)+1)*(120+220*Math.floor(a/5)+420*Math.floor(a*a/225)+420*Math.floor(a*a/2025))):Math.round((.3*!(a%5)+1)*(.4*!(a%15)+1)*(.5*!(a%45)+1)*(120+260*Math.floor(a/5)+500*Math.floor(a*a/225)+480*Math.floor(a*a/2025)))}function getLevel(a){var e,t=EXP.length;for(e=0;e<t&&!(a<EXP[e]);e++);return e+1}function getLevelImage(a){var e=getLevel(a)-1,t=e%25*-100,o=-100*Math.floor(.04*e);return a<0?getImage(`https://cdn.jsdelivr.net/npm/kkutudotnet@latest/img/kkutu/lv/gm.png?v=${L.version}`):$("<div>").css({float:"left","background-image":`url('https://cdn.jsdelivr.net/npm/kkutudotnet@latest/img/kkutu/lv/newlv.png?v=${L.version}')`,"background-position":t+"% "+o+"%","background-size":"2560%"})}function getImage(a){return $("<div>").addClass("jt-image").css("background-image","url('"+a+"')")}function getOptions(a,e,t){var o,r=[L["mode"+MODE[a]]];for(o in OPTIONS)e[OPTIONS[o].name.toLowerCase()]&&r.push(L["opt"+OPTIONS[o].name]);return t&&r.push(e.injpick.join("|")),t?r.toString():r}function setRoomHead(a,e){var t,o=getOptions(e.mode,e.opts),r=RULE[MODE[e.mode]];a.empty().append(mobile?"":'<h5 style="position: absolute;left: 50%;transform: translateX(-50%);font-weight: bold;">KKUTU.XYZ</h5>').append($("<h5>").addClass("room-head-number").html("["+(e.practice?L.practice:e.id)+"]")).append($("<h5>").addClass("room-head-title").text(badWords(e.title))).append(t=$("<h5>").addClass("room-head-mode").html(o.join(" / "))).append($("<h5>").addClass("room-head-limit").html((mobile?"":L.players+" ")+e.players.length+" / "+e.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+e.round)).append($("<h5>").addClass("room-head-time").html(e.time+L.SECOND)),-1!=r.opts.indexOf("ijp")&&(t.append($("<div>").addClass("expl").html("<h5>"+e.opts.injpick.map(function(a){return L["theme_"+a]})+"</h5>")),global.expl(a))}function loadSounds(a,e,t){$data._lsRemain=a.length,a.forEach(function(a){getAudio(a.key,a.value,e,t)})}function getAudio(a,e,t,o){var r=new XMLHttpRequest;function d(t){$sound[a]=new function(a){var e=this;this.audio=new Audio(a),this.audio.load(),this.start=function(){e.audio.play()},this.stop=function(){e.audio.currentTime=0,e.audio.pause()}}(e),i()}function i(){0==--$data._lsRemain?t&&t():o||loading(L.loadRemain+$data._lsRemain)}r.open("GET",e),r.responseType="arraybuffer",r.onload=function(e){audioContext?audioContext.decodeAudioData(e.target.response,function(e){$sound[a]=e,i()},d):d()},r.send()}function playBGM(a,e){return $data.bgm&&$data.bgm.stop(),$data.bgm=playSound(a,!0)}function stopBGM(){$data.bgm&&($data.bgm.stop(),delete $data.bgm)}function playSound(a,e){var t,o,r=e&&$data.muteBGM||!e&&$data.muteEff,d=e?$data.opts.vb?$data.opts.vb:1:$data.opts.ve?$data.opts.ve:1;if(o=$sound[a]||$sound.missing,window.hasOwnProperty("AudioBuffer")&&o instanceof AudioBuffer){if((t=audioContext.createBufferSource()).startedAt=audioContext.currentTime,t.loop=e,r)t.buffer=audioContext.createBuffer(2,o.length,audioContext.sampleRate);else{t.buffer=o;var i="function"==typeof audioContext.createGain?audioContext.createGain():null;i&&(i.gain.value=Number(d)-1,i.connect(audioContext.destination),t.connect(i))}t.connect(audioContext.destination)}else o.readyState&&(o.audio.currentTime=0),o.audio.loop=e||!1,o.audio.volume=d,t=o;return $_sound[a]&&$_sound[a].stop(),$_sound[a]=t,t.key=a,t.start(),t}function stopAllSounds(){var a;for(a in $_sound)$_sound[a].stop()}function tryJoin(a){$data.rooms[a]&&($data.rooms[a].password?akPrompt.password(L.putPassword,function(e){e&&($data._pw=e,send("enter",{id:a,password:e}))}):($data._pw=void 0,send("enter",{id:a,password:void 0})))}function clearChat(){$("#Chat").empty()}function forkChat(){var a=$("#Chat,#chat-log-board"),e=a.children(".chat-item").last().get(0);e&&"HR"==e.tagName||(a.append($("<hr>").addClass("chat-item")),$stage.chat.scrollTop(999999999))}function badWords(a){if($data.opts.isbad){if($data.opts.isbad){if(!$data.opts.isadvbad)return a.replace(BAD,"[욕설]");if($data.opts.isadvbad)return a.replace(ADVBAD,"[욕설]")}}else{if(!$data.opts.isadvbad)return a;if($data.opts.isadvbad)return a.replace(ADVBAD,"[욕설]")}}function chatBalloon(a,e,t){$("#cb-"+e).remove();var o,r,d=(2&t?$("#game-user-"+e):$("#room-user-"+e)).offset(),i=2==t?"chat-balloon-bot":"chat-balloon-tip",s=$("<div>").addClass("chat-balloon").attr("id","cb-"+e).append($("<div>").addClass("jt-image "+i))[2==t?"prepend":"append"]($("<h4>").text(a));d&&($stage.balloons.append(s),1==t?(o=0,r=220):2==t?(o=35-s.height(),r=-2):3==t?(o=5,r=210):(o=40,r=110),s.css({top:d.top+o,left:d.left+r}),addTimeout(function(){s.animate({opacity:0},500,function(){s.remove()})},2500))}function chat(a,e,t,o){var r,d,i,s,n=o?new Date(o):new Date,l=$data.users[a.id]?$data.users[a.id].equip:{};if(!$data._shut[a.title||a.name]){if(t){if($data.opts.dw)return;if($data._wblock[t])return}e=badWords(e),playSound("k"),stackChat(),!mobile&&$data.room&&(r=($data.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),chatBalloon(e,a.id,r)),$stage.chat.append(i=$("<div>").addClass("chat-item").append(r=$("<div>").addClass("chat-head ellipse").text(a.title||a.name)).append(d=$("<div>").addClass("chat-body").text(e)).append($("<div>").addClass("chat-stamp").text(n.toLocaleTimeString()))),o&&r.prepend($("<i>").addClass("kd kd-video-camera")),r.on("click",function(e){requestProfile(a.id)}),$stage.chatLog.append(i=i.clone()),i.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(a.id||"").substr(0,5))),(s=e.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(e=d.html(),s.forEach(function(a){e=e.replace(a,"<a href='#' style='color: #2222FF;' onclick='linkConfirm(\""+a+"\");'>"+a+"</a>")}),d.html(e)),t&&(!0!==t&&($data._recentFrom=t),d.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+d.html())),addonNickname(r,{equip:l}),$stage.chat.scrollTop(999999999)}}function drawCanvas(a){route("drawCanvas",a)}function notice(a,e){var t=new Date;playSound("k"),stackChat(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(e||L.notice)).append($("<div>").addClass("chat-body").html(a)).append($("<div>").addClass("chat-stamp").text(t.toLocaleTimeString()))),$stage.chat.scrollTop(999999999),"tail"==e&&console.warn(t.toLocaleString(),a)}function stackChat(){var a=$("#Chat .chat-item"),e=$("#chat-log-board .chat-item");a.length>99&&a.first().remove(),e.length>199&&e.first().remove()}function iGoods(a){var e;return{_id:a,group:(e="$"==a.charAt()?$data.shop[a.slice(0,4)]:$data.shop[a]).group,term:e.term,name:iName(a),cost:e.cost,image:iImage(a,e),desc:iDesc(a),options:e.options}}function iName(a){return"$"==a.charAt()?L["item_"+a.slice(0,4)]+" - "+a.slice(4):L["item_"+a]}function iDesc(a){return"$"==a.charAt()?L["expl_"+a.slice(0,4)]:L["expl_"+a]}function iImage(a,e){var t,o;if(a){if("$"==a.charAt())return iDynImage(a.slice(1,4),a.slice(4))}else"string"==typeof e&&(e={_id:"def",group:e,options:{}});return o=(t=$data.shop[a]||e).options.hasOwnProperty("gif")?".gif":".png","BDG"==t.group.slice(0,3)?CDN+"/img/kkutu/moremi/badge/"+t._id+o:"M"==t.group.charAt(0)?CDN+"/img/kkutu/moremi/"+t.group.slice(1)+"/"+t._id+o:CDN+"/img/kkutu/shop/"+t._id+".png"}function iDynImage(a,e){var t,o=document.createElement("canvas"),r=o.getContext("2d");switch(o.width=o.height=50,r.font="24px NBGothic",r.textAlign="center",r.textBaseline="middle",a){case"WPC":case"WPB":case"WPA":t=["WPC","WPB","WPA"].indexOf(a),r.beginPath(),r.arc(25,25,25,0,2*Math.PI),r.fillStyle=["#DDDDDD","#A6C5FF","#FFEF31"][t],r.fill(),r.fillStyle=["#000000","#4465C3","#E69D12"][t],r.fillText(e,25,25)}return o.toDataURL()}function queueObtain(a){$stage.dialog.obtain.is(":visible")?$data._obtain.push(a):(drawObtain(a),showDialog($stage.dialog.obtain,!0))}function drawObtain(a){playSound("success"),$("#obtain-image").css("background-image","url("+iImage(a.key)+")"),$("#obtain-name").html(iName(a.key))}function renderMoremi(a,e){var t,o,r=$(a).empty(),d={Mlhand:"Mhand",Mrhand:"Mhand"};for(t in e||(e={}),MOREMI_PART)o="M"+MOREMI_PART[t],r.append($("<img>").addClass("moremies moremi-"+o.slice(1)).attr("src",iImage(e[o],d[o]||o)).css({width:"100%",height:"100%"}));(o=e.BDG)&&r.append($("<img>").addClass("moremies moremi-badge").attr("src",iImage(o)).css({width:"100%",height:"100%"})),r.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",e.robot?CDN+"/img/kkutu/moremi/robot.png":CDN+"/img/kkutu/moremi/body.png").css({width:"100%",height:"100%"})),r.children(".moremi-rhand").css("transform","scaleX(-1)")}function commify(a){var e=/(^[+-]?\d+)(\d{3})/;if(null===a)return"?";for(a=a.toString();e.test(a);)a=a.replace(e,"$1,$2");return a}function setLocation(a){location.hash=a?"#"+a:""}function fail(a){return akAlert(L["error_"+a],!0)}function yell(a){$stage.yell.show().css("opacity",1).html(a),addTimeout(function(){$stage.yell.animate({opacity:0},3e3),addTimeout(function(){$stage.yell.hide()},3e3)},1e3)}function linkConfirm(a){akConfirm(L.linkWarning,function(e){e&&window.open(a)},!0)}delete window.WebSocket,delete window.setInterval;