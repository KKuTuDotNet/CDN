/**
ⓒ 2017-2019 KKuTuDotNet. All Rights Reserved.
This program is distributed by terms of GNU Affero General Public License.
For more information, please check <https://www.gnu.org/licenses/agpl-3.0.html>.
*/


!function(){var t={y:50,t:50,g:100,l:200,m:600};function n(n,a,e,i,d){return l="word-"+[n,a,e,i].join("-"),p=i,r=d,$("<input>").attr("id",l).css("width",t[p]).val(r);var l,p,r}function a(t,n,a){var i=["wa",t,n,a].join("-")+"-";return $("<td>").append($("<button>").attr("id",i+"u").css("float","left").html("▲").on("click",e)).append($("<button>").attr("id",i+"x").css("float","left").html("X").on("click",e)).append($("<button>").attr("id",i+"e").css("float","left").html("?").on("click",e)).append($("<button>").attr("id",i+"d").css("float","left").html("▼").on("click",e))}function e(t){var n,a=$(t.currentTarget).attr("id").slice(3).split("-"),e=a.pop(),d=$("#wr-"+a.join("-"));switch(e){case"u":t.shiftKey&&(i(d,d.prev().attr("id").slice(3)),i(d.prev(),a.join("-"))),d.prev().before(d);break;case"x":d.remove();break;case"e":(n=prompt("새 key"))&&i(d,n);break;case"d":t.shiftKey&&(i(d,d.next().attr("id").slice(3)),i(d.next(),a.join("-"))),d.next().after(d)}}function i(t,n){var a=t.attr("id").slice(3);t.attr("id","wr-"+n).children("td").first().html(n),t.find("*").each(function(t,e){var i=$(e);i.attr("id")&&-1!=i.attr("id").indexOf(a)&&i.attr("id",i.attr("id").replace(a,n))})}$(document).ready(function(){$("#db-ok").on("click",function(t){"~"==$("#db-theme").val().charAt()?($("#db-list").val(""),$.get("/kpanel/kkututheme?theme="+$("#db-theme").val().slice(1)+"&lang="+$("#db-lang").val(),function(t){$("#db-list").val(t.list.join("\n"))})):$.post("/kpanel/kkutudb",{pw:$("#db-password").val(),lang:$("#db-lang").val(),theme:$("#db-theme").val(),list:$("#db-list").val()},function(t){alert(t)})}),$("#db-go").on("click",function(t){$.get("/kpanel/kkutudb/"+$("#db-word").val()+"?lang="+$("#db-lang").val(),function(t){var e=$("#wd-data").empty(),i=t.type?t.type.split(","):[],d=t.theme?t.theme.split(","):[],l=t.mean?t.mean.split(/＂[0-9]+＂/).slice(1).map(function(t){return-1==t.indexOf("［")?[[t]]:t.split(/［[0-9]+］/).slice(1).map(function(t){return t.split(/（[0-9]+）/).slice(1)})}):[[[]]];$("#wd-flag").val(t.flag),l.forEach(function(t,l){t.forEach(function(t,p){var r,o=i.shift();t.forEach(function(t,i){r=d.shift(),e.append($("<tr>").attr("id",["wr",l,p,i].join("-")).append($("<td>").html([l,p,i].join("-"))).append($("<td>").append(n(l,p,i,"y",o))).append($("<td>").append(n(l,p,i,"t",r))).append($("<td>").append(n(l,p,i,"m",t))).append(a(l,p,i)))})})})})}),$("#word-add").on("click",function(t){var e=prompt("key (-로 구분)");e&&(e=e.split("-"),$("#wd-data").append($("<tr>").attr("id",["wr",e[0],e[1],e[2]].join("-")).append($("<td>").html([e[0],e[1],e[2]].join("-"))).append($("<td>").append(n(e[0],e[1],e[2],"y",""))).append($("<td>").append(n(e[0],e[1],e[2],"t",""))).append($("<td>").append(n(e[0],e[1],e[2],"m",""))).append(a(e[0],e[1],e[2]))))}),$("#db-apply").on("click",function(t){var n={_id:$("#db-word").val(),flag:$("#wd-flag").val(),type:[],theme:[],mean:[]},a=!1;$("#wd-data tr").each(function(t,e){var i=$(e).children("td").first().html().split("-"),d=i[0]+"-"+i[1],l={type:$("#word-"+[i[0],i[1],i[2],"y"].join("-")).val(),theme:$("#word-"+[i[0],i[1],i[2],"t"].join("-")).val(),mean:$("#word-"+[i[0],i[1],i[2],"m"].join("-")).val()};a!=d&&(n.type.push(l.type),a=d),n.theme.push(l.theme),n.mean[i[0]]||(n.mean[i[0]]=[]),n.mean[i[0]][i[1]]||(n.mean[i[0]][i[1]]=[]),n.mean[i[0]][i[1]][i[2]]=l.mean}),n.type=n.type.join(","),n.theme=n.theme.join(","),n.mean=n.mean.map(function(t,n){return"ko"==$("#db-lang").val()?"＂"+(n+1)+"＂"+t.map(function(t,n){return"［"+(n+1)+"］"+t.map(function(t,n){return"（"+(n+1)+"）"+t}).join("")}).join(""):"＂"+(n+1)+"＂"+t}).join(""),$.post("/kpanel/kkutudb/"+$("#db-word").val(),{pw:$("#db-password").val(),lang:$("#db-lang").val(),data:JSON.stringify(n)},function(t){alert(t)})})})}();